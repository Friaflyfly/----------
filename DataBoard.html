<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®çœ‹æ¿ - å¤©åˆçŸ­å‰§å‰ªè¾‘æ¥å•å¹³å°</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.css">
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  <script src="https://unpkg.com/@antv/g2@5/dist/g2.min.js"></script>
  <style>
    body { margin: 0; padding: 0; }
    .appLayout { display: flex; min-height: 100vh; }
    .sidebar {
      width: 200px; background: #fff; box-shadow: 2px 0 8px rgba(0,0,0,0.06);
      position: fixed; left: 0; top: 0; bottom: 0; overflow-y: auto; z-index: 100;
    }
    .sidebarHeader { padding: 20px 16px; border-bottom: 1px solid #f0f0f0; }
    .logo { font-size: 18px; font-weight: 600; color: #1890ff; text-decoration: none; display: block; }
    .menu { padding: 16px 0; }
    .menuItem {
      display: block; padding: 12px 24px; color: #262626; text-decoration: none; font-size: 14px;
      border-left: 3px solid transparent; transition: all 0.3s;
    }
    .menuItem:hover { background: #f0f0f0; color: #1890ff; }
    .menuItem.active { background: #e6f7ff; color: #1890ff; border-left-color: #1890ff; font-weight: 500; }
    .menuItemIcon { margin-right: 8px; font-size: 16px; }
    .menuGroup { margin-top: 16px; padding-top: 16px; border-top: 1px solid #f0f0f0; }
    .menuGroupTitle { padding: 8px 24px; font-size: 12px; color: #8c8c8c; font-weight: 600; }
    .mainContent { flex: 1; margin-left: 200px; min-height: 100vh; background: #f5f5f5; }
    .boardPage { padding: 24px; }
    .pageHeader { background: #fff; padding: 16px 24px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .kpiRow { display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; }
    .kpiCard {
      flex: 1; min-width: 200px; background: #fff; padding: 24px; border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .kpiTitle { font-size: 14px; color: #8c8c8c; margin-bottom: 8px; }
    .kpiValue { font-size: 28px; font-weight: 600; color: #262626; }
    .chartCard { background: #fff; padding: 24px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .chartTitle { font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #262626; }
    .chartWrap { width: 100%; height: 320px; }
    .sectionTitle { font-size: 18px; font-weight: 600; margin: 24px 0 16px; color: #262626; }
    .kanbanRow { display: flex; gap: 16px; overflow-x: auto; padding-bottom: 8px; min-height: 200px; }
    .kanbanCol { flex: 0 0 260px; background: #fafafa; border-radius: 8px; border: 1px solid #f0f0f0; display: flex; flex-direction: column; }
    .kanbanColHead { padding: 12px 16px; font-weight: 600; font-size: 14px; color: #262626; border-bottom: 1px solid #f0f0f0; }
    .kanbanColBody { padding: 8px; flex: 1; overflow-y: auto; }
    .projectCard {
      background: #fff; border-radius: 6px; padding: 12px; margin-bottom: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.06);
      border-left: 3px solid #1890ff;
    }
    .projectCard a { color: #262626; text-decoration: none; display: block; }
    .projectCard a:hover { color: #1890ff; }
    .projectCardName { font-weight: 500; margin-bottom: 4px; }
    .projectCardMeta { font-size: 12px; color: #8c8c8c; }
    .progressGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .progressCard {
      background: #fff; border-radius: 8px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border-top: 3px solid #1890ff;
    }
    .progressCardName { font-weight: 600; margin-bottom: 8px; font-size: 15px; }
    .progressCardLink { color: #1890ff; text-decoration: none; }
    .progressCardLink:hover { text-decoration: underline; }
    .progressCardBar { height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin: 8px 0; }
    .progressCardBarFill { height: 100%; background: #52c41a; border-radius: 4px; }
    .progressCardMeta { font-size: 13px; color: #8c8c8c; }
    .timelineTable { width: 100%; border-collapse: collapse; font-size: 13px; }
    .timelineTable th, .timelineTable td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #f0f0f0; }
    .timelineTable th { background: #fafafa; font-weight: 600; color: #262626; }
    .timelineTable a { color: #1890ff; text-decoration: none; }
    .timelineTable a:hover { text-decoration: underline; }
    .timelineWrap { width: 100%; height: 360px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.js"></script>
  <script>
    (function() {
      var antd = typeof antd !== 'undefined' ? antd : {};
      var Typography = antd.Typography || {};
      var Title = Typography.Title || 'div';

      function getUrlParam(key) {
        const m = new RegExp('([?&])' + key + '=([^&]*)').exec(window.location.search);
        return m ? decodeURIComponent(m[2]) : null;
      }

      // èšåˆçœ‹æ¿æ•°æ®ï¼šé¡¹ç›®æ¥è‡ª adminProjects + mockProjectsï¼›æ€»è®¡åˆ’é›†æ•° = å„è®¢å• episodeCount ä¹‹å’Œï¼›å¾…è¿›é›†æ•° = æ€»è®¡åˆ’é›†æ•° âˆ’ å·²äº¤ä»˜é›†æ•°
      function aggregateBoardData() {
        try {
        const adminProjects = JSON.parse(localStorage.getItem('adminProjects') || '[]');
        const mockProjects = JSON.parse(localStorage.getItem('mockProjects') || '[]');
        const projectIdSet = new Set();
        const projects = [];
        adminProjects.forEach(p => { if (!projectIdSet.has(p.id)) { projectIdSet.add(p.id); projects.push(p); } });
        mockProjects.forEach(p => { if (!projectIdSet.has(p.id)) { projectIdSet.add(p.id); projects.push(p); } });

        // çœ‹æ¿å±•ç¤ºç”¨å‡æ•°æ®ï¼šå½“é¡¹ç›®è¾ƒå°‘æˆ–çŠ¶æ€å•ä¸€æ—¶è¡¥å…¨ã€ŒçŸ­å‰§é¡¹ç›®æƒ…å†µã€å„åˆ—æ ·å¼
        var statusCityCombos = [
          { projectStatusL1: 'åœ¨åˆ¶ä¸­', city: 'é•¿æ²™' }, { projectStatusL1: 'åœ¨åˆ¶ä¸­', city: 'è¥¿å®‰' },
          { projectStatusL1: 'å·²äº¤ä»˜', city: 'é•¿æ²™' }, { projectStatusL1: 'å·²äº¤ä»˜', city: 'è¥¿å®‰' },
          { projectStatusL1: 'å¾…è¿›', city: 'é•¿æ²™' }, { projectStatusL1: 'å¾…è¿›', city: 'è¥¿å®‰' },
        ];
        var stages = ['ç²¾å‰ªä¸­', 'å†…éƒ¨ä¸€å®¡', 'å†…éƒ¨äºŒå®¡', 'å¯¼æ¼”å®¡', 'ç›‘åˆ¶å®¡', 'å¹³å°å®¡', 'å®¡æ ¸å®Œæˆ'];
        var fakeNames = ['éœ¸é“æ€»è£é€†è¢­è®°', 'é‡ç”Ÿä¹‹éƒ½å¸‚ä»™å°Š', 'é—ªå©šåè¢«å® ä¸Šå¤©', 'ç¥åŒ»ç‹å¦ƒ', 'ç©¿è¶Šä¹‹é”¦ç»£ç”°å›­', 'ç”œå¦»æ¥è¢­', 'èŒå®åŠ©æ”»', 'å½±åå¥¹åªæƒ³æäº‹ä¸š'];
        var existingKeys = {};
        projects.forEach(function(p) {
          var k = (p.projectStatusL1 || 'åœ¨åˆ¶ä¸­') + ' (' + (p.city || 'é•¿æ²™') + ')';
          existingKeys[k] = true;
        });
        statusCityCombos.forEach(function(combo, idx) {
          var key = combo.projectStatusL1 + ' (' + combo.city + ')';
          if (existingKeys[key]) return;
          var baseId = 'MOCK_BOARD_' + key.replace(/\s|\(|\)/g, '_') + '_';
          for (var i = 0; i < 2; i++) {
            var id = baseId + (idx * 2 + i);
            if (projectIdSet.has(id)) continue;
            projectIdSet.add(id);
            projects.push({
              id: id,
              projectName: fakeNames[(idx * 2 + i) % fakeNames.length] + 'ï¼ˆç¤ºä¾‹ï¼‰',
              city: combo.city,
              projectStatusL1: combo.projectStatusL1,
              projectStage: stages[(idx * 2 + i) % stages.length],
              episodeCount: 12 + (idx + i) * 2,
            });
          }
          existingKeys[key] = true;
        });

        const currentOrders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
        const projectMap = {};
        projects.forEach(p => { projectMap[p.id] = projectMap[String(p.id)] = p; });

        // æ€»è®¡åˆ’é›†æ•° = å„è®¢å• episodeCount ä¹‹å’Œ
        const totalPlanEpisodes = currentOrders.reduce((sum, o) => sum + (Number(o.episodeCount) || 0), 0);

        let deliveredEpisodes = 0;
        const byStatusCity = {};
        const episodeByStatus = { 'å¾…è¿›': 0, 'å·²äº¤ä»˜': 0, 'åœ¨åˆ¶ä¸­': 0 };

        const projectsList = [];
        const stageOrder = ['ç²¾å‰ªä¸­', 'å†…éƒ¨ä¸€å®¡', 'å†…éƒ¨äºŒå®¡', 'å¯¼æ¼”å®¡', 'ç›‘åˆ¶å®¡', 'å¹³å°å®¡', 'å®¡æ ¸å®Œæˆ'];

        projects.forEach(p => {
          const city = p.city || 'é•¿æ²™';
          const l1 = p.projectStatusL1 || 'åœ¨åˆ¶ä¸­';
          const stage = p.projectStage || 'ç²¾å‰ªä¸­';
          const key = l1 + ' (' + city + ')';
          byStatusCity[key] = (byStatusCity[key] || 0) + 1;

          let projectEpisodes = 0;
          currentOrders.forEach(o => {
            if (o.projectId === p.id || o.projectId == p.id) {
              projectEpisodes += Number(o.episodeCount) || 0;
            }
          });
          if (projectEpisodes === 0) projectEpisodes = Number(p.episodeCount) || 0;

          if (l1 === 'å·²äº¤ä»˜') {
            deliveredEpisodes += projectEpisodes;
            episodeByStatus['å·²äº¤ä»˜'] += projectEpisodes;
          } else if (l1 === 'åœ¨åˆ¶ä¸­') {
            episodeByStatus['åœ¨åˆ¶ä¸­'] += projectEpisodes;
          } else {
            episodeByStatus['å¾…è¿›'] += projectEpisodes;
          }

          projectsList.push({
            id: p.id,
            projectName: p.projectName || p.id,
            city: city,
            projectStatusL1: l1,
            projectStage: stage,
            planEpisodes: projectEpisodes,
            deliveredEpisodes: l1 === 'å·²äº¤ä»˜' ? projectEpisodes : 0,
          });
        });

        // å¾…è¿›é›†æ•°å£å¾„ï¼šæ€»è®¡åˆ’é›†æ•° âˆ’ å·²äº¤ä»˜é›†æ•°
        const pendingEpisodesKpi = totalPlanEpisodes - deliveredEpisodes;
        const statusCityKeys = Object.keys(byStatusCity).sort();
        const stageKeys = stageOrder.filter(s => projectsList.some(p => p.projectStage === s));

        // çŸ­å‰§è¿›å®¡æ—¶é—´ï¼šè®¢å•æ¥å•â†’æˆªæ­¢æ—¶é—´çº¿ï¼ˆç”¨äºè¡¨æ ¼ä¸ç”˜ç‰¹å›¾ï¼‰ï¼Œä¾èµ– dayjs æ—¶å®‰å…¨é™çº§
        const timelineData = [];
        var hasDayjs = typeof dayjs !== 'undefined' && typeof dayjs().isValid === 'function';
        currentOrders.forEach(function(o) {
          var startMs, endMs, takeStr, dueStr;
          if (hasDayjs) {
            var take = (o.takeTime && dayjs(o.takeTime).isValid()) ? dayjs(o.takeTime) : dayjs();
            var due = (o.dueTime && dayjs(o.dueTime).isValid()) ? dayjs(o.dueTime) : dayjs().add(7, 'day');
            startMs = take.valueOf();
            endMs = due.valueOf();
            takeStr = o.takeTime || take.format('YYYY-MM-DD HH:mm');
            dueStr = o.dueTime || due.format('YYYY-MM-DD HH:mm');
          } else {
            startMs = Date.now();
            endMs = startMs + 86400000 * 7;
            takeStr = o.takeTime || '';
            dueStr = o.dueTime || '';
          }
          if (endMs < startMs) endMs = startMs + 86400000 * 7;
          timelineData.push({
            orderId: o.orderId || o.id,
            projectId: o.projectId,
            projectName: o.projectName || 'é¡¹ç›®',
            taker: o.taker || '-',
            takeTime: takeStr,
            dueTime: dueStr,
            status: o.status || 'InProgress',
            startMs: startMs,
            endMs: endMs,
            label: (o.projectName || o.orderId || o.id) + ' Â· ' + (o.orderId || o.id),
          });
        });
        timelineData.sort(function(a, b) { return a.startMs - b.startMs; });

        return {
          totalCount: projects.length,
          totalPlanEpisodes,
          pendingEpisodes: pendingEpisodesKpi,
          deliveredEpisodes,
          episodeByStatus,
          pieData: Object.entries(byStatusCity).map(function(e) { return { name: e[0], value: e[1] }; }),
          barData: [
            { status: 'å¾…è¿›', episodes: episodeByStatus['å¾…è¿›'] },
            { status: 'å·²äº¤ä»˜', episodes: episodeByStatus['å·²äº¤ä»˜'] },
            { status: 'åœ¨åˆ¶ä¸­', episodes: episodeByStatus['åœ¨åˆ¶ä¸­'] },
          ],
          projectsList: projectsList,
          statusCityKeys: statusCityKeys,
          stageKeys: stageKeys,
          stageOrder: stageOrder,
          timelineData: timelineData,
        };
        } catch (err) {
          return {
            totalCount: 0,
            totalPlanEpisodes: 0,
            pendingEpisodes: 0,
            deliveredEpisodes: 0,
            episodeByStatus: { 'å¾…è¿›': 0, 'å·²äº¤ä»˜': 0, 'åœ¨åˆ¶ä¸­': 0 },
            pieData: [],
            barData: [{ status: 'å¾…è¿›', episodes: 0 }, { status: 'å·²äº¤ä»˜', episodes: 0 }, { status: 'åœ¨åˆ¶ä¸­', episodes: 0 }],
            projectsList: [],
            statusCityKeys: [],
            stageKeys: [],
            stageOrder: ['ç²¾å‰ªä¸­', 'å†…éƒ¨ä¸€å®¡', 'å†…éƒ¨äºŒå®¡', 'å¯¼æ¼”å®¡', 'ç›‘åˆ¶å®¡', 'å¹³å°å®¡', 'å®¡æ ¸å®Œæˆ'],
            timelineData: [],
          };
        }
      }

      const DataBoard = () => {
        const [mounted, setMounted] = React.useState(false);
        const data = React.useMemo(aggregateBoardData, []);

        React.useEffect(() => {
          setMounted(true);
        }, []);

        React.useEffect(() => {
          if (!mounted || typeof G2 === 'undefined') return;

          const pieContainer = document.getElementById('chart-pie');
          const barContainer = document.getElementById('chart-bar');
          const timelineContainer = document.getElementById('chart-timeline');
          if (!pieContainer || !barContainer) return;

          pieContainer.innerHTML = '';
          barContainer.innerHTML = '';
          if (timelineContainer) timelineContainer.innerHTML = '';

          const { Chart } = G2;
          const pieData = data.pieData.length ? data.pieData : [
            { name: 'åœ¨åˆ¶ä¸­ (é•¿æ²™)', value: 21 },
            { name: 'åœ¨åˆ¶ä¸­ (è¥¿å®‰)', value: 2 },
            { name: 'å·²äº¤ä»˜ (è¥¿å®‰)', value: 3 },
            { name: 'å¾…è¿› (é•¿æ²™)', value: 21 },
            { name: 'å¾…è¿› (è¥¿å®‰)', value: 1 },
          ];

          const pieChart = new Chart({
            container: pieContainer,
            width: pieContainer.offsetWidth,
            height: 320,
          });
          pieChart.options({
            data: pieData,
            coordinate: { type: 'theta', outerRadius: 0.8 },
            scale: { value: { type: 'linear', min: 0 } },
            legend: { color: { position: 'bottom', layout: { justifyContent: 'center' } } },
            children: [
              { type: 'interval', transform: [{ type: 'stackY' }], encode: { y: 'value', color: 'name' } },
            ],
          });
          pieChart.render();

          const barData = data.barData.every(d => d.episodes === 0)
            ? [{ status: 'å¾…è¿›', episodes: 1760 }, { status: 'å·²äº¤ä»˜', episodes: 240 }, { status: 'åœ¨åˆ¶ä¸­', episodes: 1821 }]
            : data.barData;

          const barChart = new Chart({
            container: barContainer,
            width: barContainer.offsetWidth,
            height: 320,
          });
          barChart.options({
            data: barData,
            axis: { y: { title: 'é›†æ•°', labelFormatter: (v) => v }, x: { title: false } },
            scale: { episodes: { type: 'linear', min: 0 } },
            children: [
              { type: 'interval', encode: { x: 'status', y: 'episodes', color: 'status' } },
            ],
          });
          barChart.render();

          var timelineChart = null;
          if (timelineContainer && data.timelineData && data.timelineData.length > 0) {
            var minMs = Math.min.apply(null, data.timelineData.map(function(d) { return d.startMs; }));
            var maxMs = Math.max.apply(null, data.timelineData.map(function(d) { return d.endMs; }));
            if (maxMs <= minMs) maxMs = minMs + 86400000 * 7;
            var ganttData = data.timelineData.map(function(d) {
              return { label: d.label.length > 24 ? d.label.slice(0, 22) + 'â€¦' : d.label, start: d.startMs, end: d.endMs };
            });
            try {
              timelineChart = new Chart({
                container: timelineContainer,
                width: timelineContainer.offsetWidth,
                height: 360,
              });
              timelineChart.options({
                data: ganttData,
                coordinate: { transform: [{ type: 'transpose' }] },
                scale: {
                  start: { type: 'linear', domain: [minMs, maxMs], tickCount: 5 },
                  end: { type: 'linear', domain: [minMs, maxMs] },
                  label: { type: 'band', padding: 0.3 },
                },
                axis: {
                  x: { title: false },
                  y: {
                    title: 'æ—¶é—´',
                    labelFormatter: function(v) {
                      if (typeof dayjs !== 'undefined') return dayjs(Number(v)).format('MM-DD');
                      return new Date(Number(v)).toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
                    },
                  },
                },
                legend: false,
                children: [
                  { type: 'interval', encode: { x: 'label', y: ['start', 'end'], color: 'label' } },
                ],
              });
              timelineChart.render();
            } catch (e) { if (timelineChart) timelineChart.destroy(); }
          }

          return () => {
            pieChart.destroy();
            barChart.destroy();
            if (timelineChart) timelineChart.destroy();
          };
        }, [mounted, data.pieData.length, data.barData, data.timelineData]);

        const Title = Typography.Title;
        return React.createElement('div', { className: 'appLayout' },
          React.createElement('div', { className: 'sidebar' },
            React.createElement('div', { className: 'sidebarHeader' },
              React.createElement('a', { href: 'Home.html', className: 'logo' }, 'ğŸ¬ å¤©åˆçŸ­å‰§å¹³å°')
            ),
            React.createElement('nav', { className: 'menu' },
              React.createElement('a', { href: 'Home.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ '), 'é¦–é¡µ'),
              React.createElement('a', { href: 'ProjectHall.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ“‹'), 'æ¥å•å¤§å…'),
              React.createElement('a', { href: 'Leaderboard.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ†'), 'å¤©æ¢¯æ¦œå•'),
              React.createElement('a', { href: 'Account.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ’°'), 'è´¦æˆ·ä¸æ”¶ç›Š'),
              React.createElement('a', { href: 'MyProjects.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸš€'), 'æˆ‘çš„é¡¹ç›®'),
              React.createElement('div', { className: 'menuGroup' },
                React.createElement('div', { className: 'menuGroupTitle' }, 'åå°ç®¡ç†'),
                React.createElement('a', { href: 'ReviewQueue.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'âœ…'), 'ä»»åŠ¡å®¡æ ¸'),
                React.createElement('a', { href: 'ProjectManagement.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ“‹'), 'é¡¹ç›®ç®¡ç†'),
                React.createElement('a', { href: 'StudentManagement.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ‘¥'), 'å­¦å‘˜ç®¡ç†'),
                React.createElement('a', { href: 'FinanceManagement.html', className: 'menuItem' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ’°'), 'è´¢åŠ¡å¯¹è´¦'),
                React.createElement('a', { href: 'DashboardManagement.html', className: 'menuItem', style: { display: 'none' } }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ“Š'), 'æ¦œå•ä¸æ•°æ®'),
                React.createElement('a', { href: 'DataBoard.html', className: 'menuItem active' }, React.createElement('span', { className: 'menuItemIcon' }, 'ğŸ“ˆ'), 'æ•°æ®çœ‹æ¿')
              )
            )
          ),
          React.createElement('div', { className: 'mainContent' },
            React.createElement('div', { className: 'boardPage' },
              React.createElement('div', { className: 'pageHeader' },
                React.createElement('div', { style: { margin: 0, fontSize: 24, fontWeight: 600 } }, '2026çŸ­å‰§æ•´ä½“æ¦‚è§ˆ')
              ),
              React.createElement('div', { className: 'kpiRow' },
                React.createElement('div', { className: 'kpiCard' },
                  React.createElement('div', { className: 'kpiTitle' }, '2026å¹´çŸ­å‰§æ€»æ•°é‡'),
                  React.createElement('div', { className: 'kpiValue' }, String(Number(data.totalCount) || 0))
                ),
                React.createElement('div', { className: 'kpiCard' },
                  React.createElement('div', { className: 'kpiTitle' }, '2026çŸ­å‰§æ€»åˆ¶ä½œé›†æ•°'),
                  React.createElement('div', { className: 'kpiValue' }, String((data.totalPlanEpisodes || 2061).toLocaleString()))
                ),
                React.createElement('div', { className: 'kpiCard' },
                  React.createElement('div', { className: 'kpiTitle' }, 'å¾…è¿›é›†æ•°'),
                  React.createElement('div', { className: 'kpiValue' }, String((data.pendingEpisodes >= 0 ? data.pendingEpisodes : 1760).toLocaleString()))
                )
              ),
              React.createElement('div', { style: { display: 'flex', gap: 16, flexWrap: 'wrap' } },
                React.createElement('div', { className: 'chartCard', style: { flex: '1 1 400px' } },
                  React.createElement('div', { className: 'chartTitle' }, 'çŸ­å‰§æ•´ä½“æƒ…å†µï¼ˆå•ä½ï¼šéƒ¨ï¼‰'),
                  React.createElement('div', { id: 'chart-pie', className: 'chartWrap' })
                ),
                React.createElement('div', { className: 'chartCard', style: { flex: '1 1 400px' } },
                  React.createElement('div', { className: 'chartTitle' }, 'çŸ­å‰§è¿›åº¦é›†æ•°åˆ†å¸ƒ'),
                  React.createElement('div', { id: 'chart-bar', className: 'chartWrap' })
                )
              ),
              React.createElement('div', { className: 'sectionTitle' }, 'çŸ­å‰§é¡¹ç›®æƒ…å†µï¼ˆæŒ‰çŠ¶å†µ+åŸå¸‚ï¼‰'),
              React.createElement('div', { className: 'kanbanRow' },
                (data.statusCityKeys || []).map(function(colKey) {
                  var list = (data.projectsList || []).filter(function(p) { return (p.projectStatusL1 + ' (' + p.city + ')') === colKey; });
                  return React.createElement('div', { key: colKey, className: 'kanbanCol' },
                    React.createElement('div', { className: 'kanbanColHead' }, String(colKey), ' (', list.length, ')'),
                    React.createElement('div', { className: 'kanbanColBody' },
                      list.map(function(p) {
                        return React.createElement('div', { key: p.id, className: 'projectCard' },
                          React.createElement('a', { href: 'ProjectDetail.html?projectId=' + encodeURIComponent(p.id) },
                            React.createElement('div', { className: 'projectCardName' }, String(p.projectName || p.id || '')),
                            React.createElement('div', { className: 'projectCardMeta' }, String(p.id || ''), ' Â· ', String(p.planEpisodes != null ? p.planEpisodes : ''), 'é›†')
                          )
                        );
                      })
                    )
                  );
                })
              ),
              React.createElement('div', { className: 'sectionTitle' }, 'é¡¹ç›®å®Œæˆè¿›åº¦ï¼ˆæŒ‰é˜¶æ®µï¼‰'),
              React.createElement('div', { className: 'kanbanRow' },
                (data.stageKeys || []).map(function(stageKey) {
                  var list = (data.projectsList || []).filter(function(p) { return p.projectStage === stageKey; });
                  return React.createElement('div', { key: stageKey, className: 'kanbanCol' },
                    React.createElement('div', { className: 'kanbanColHead' }, String(stageKey), ' (', list.length, ')'),
                    React.createElement('div', { className: 'kanbanColBody' },
                      list.map(function(p) {
                        return React.createElement('div', { key: p.id, className: 'projectCard' },
                          React.createElement('a', { href: 'ProjectDetail.html?projectId=' + encodeURIComponent(p.id) },
                            React.createElement('div', { className: 'projectCardName' }, String(p.projectName || p.id || '')),
                            React.createElement('div', { className: 'projectCardMeta' }, String(p.id || ''), ' Â· ', String(p.planEpisodes != null ? p.planEpisodes : ''), 'é›†')
                          )
                        );
                      })
                    )
                  );
                })
              ),
              React.createElement('div', { className: 'sectionTitle' }, 'çŸ­å‰§è¿›å®¡æ—¶é—´'),
              React.createElement('div', { className: 'chartCard', style: { marginBottom: 16 } },
                React.createElement('div', { className: 'chartTitle' }, 'è®¢å•æ¥å•ä¸æˆªæ­¢æ—¶é—´'),
                React.createElement('table', { className: 'timelineTable' },
                  React.createElement('thead', null,
                    React.createElement('tr', null,
                      React.createElement('th', null, 'è®¢å•å·'),
                      React.createElement('th', null, 'é¡¹ç›®'),
                      React.createElement('th', null, 'æ¥å•äºº'),
                      React.createElement('th', null, 'æ¥å•æ—¶é—´'),
                      React.createElement('th', null, 'æˆªæ­¢æ—¶é—´'),
                      React.createElement('th', null, 'çŠ¶æ€')
                    )
                  ),
                  React.createElement('tbody', null,
                    (data.timelineData && data.timelineData.length > 0)
                      ? data.timelineData.map(function(row) {
                          return React.createElement('tr', { key: row.orderId },
                            React.createElement('td', null,
                              React.createElement('a', { href: 'ProjectSpace.html?orderId=' + encodeURIComponent(row.orderId) + '&projectId=' + encodeURIComponent(row.projectId || '') }, String(row.orderId || ''))
                            ),
                            React.createElement('td', null, String(row.projectName || '')),
                            React.createElement('td', null, String(row.taker || '')),
                            React.createElement('td', null, String(row.takeTime || '')),
                            React.createElement('td', null, String(row.dueTime || '')),
                            React.createElement('td', null, row.status === 'InProgress' ? 'è¿›è¡Œä¸­' : row.status === 'Submitted' ? 'å·²æäº¤' : row.status === 'Approved' ? 'å·²é€šè¿‡' : row.status === 'Accepted' ? 'å·²éªŒæ”¶' : String(row.status || '-'))
                          );
                        })
                      : React.createElement('tr', null, React.createElement('td', { colSpan: 6, style: { textAlign: 'center', color: '#8c8c8c', padding: 24 } }, 'æš‚æ— è®¢å•æ•°æ®'))
                  )
                ),
                (data.timelineData && data.timelineData.length > 0)
                  ? React.createElement('div', { className: 'chartTitle', style: { marginTop: 24 } }, 'æ—¶é—´åˆ†å¸ƒï¼ˆæ¥å• â†’ æˆªæ­¢ï¼‰')
                  : null,
                (data.timelineData && data.timelineData.length > 0)
                  ? React.createElement('div', { id: 'chart-timeline', className: 'timelineWrap' })
                  : null
              ),
              React.createElement('div', { className: 'sectionTitle' }, 'çŸ­å‰§å…·ä½“å®Œæˆè¿›åº¦'),
              React.createElement('div', { className: 'progressGrid' },
                (data.projectsList && data.projectsList.length > 0)
                  ? data.projectsList.map(function(p) {
                      var pct = p.planEpisodes ? Math.round(100 * p.deliveredEpisodes / p.planEpisodes) : 0;
                      return React.createElement('div', { key: p.id, className: 'progressCard' },
                        React.createElement('a', { className: 'progressCardLink', href: 'ProjectDetail.html?projectId=' + encodeURIComponent(p.id) }, String(p.projectName || p.id || '')),
                        React.createElement('div', { className: 'progressCardMeta' }, String(p.projectStage || ''), ' Â· ', String(p.city || '')),
                        React.createElement('div', { className: 'progressCardBar' },
                          React.createElement('div', { className: 'progressCardBarFill', style: { width: pct + '%' } })
                        ),
                        React.createElement('div', { className: 'progressCardMeta' }, 'å·²äº¤ä»˜ ', String(p.deliveredEpisodes != null ? p.deliveredEpisodes : ''), ' / ', String(p.planEpisodes != null ? p.planEpisodes : ''), ' é›†')
                      );
                    })
                  : React.createElement('div', { style: { gridColumn: '1 / -1', padding: 24, textAlign: 'center', color: '#8c8c8c' } }, 'æš‚æ— é¡¹ç›®æ•°æ®')
              )
            )
          )
        );
      };

      function doRender() {
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
          setTimeout(doRender, 100);
          return;
        }
        var root = document.getElementById('root');
        if (root) ReactDOM.render(React.createElement(DataBoard), root);
      }
      if (document.readyState === 'loading') window.addEventListener('load', doRender);
      else doRender();
    })();
  </script>
</body>
</html>
