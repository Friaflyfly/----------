<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¦œå•ä¸æ•°æ® - å¤©åˆçŸ­å‰§å‰ªè¾‘æ¥å•å¹³å°</title>
  
  <!-- Ant Design CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.css">
  
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .appLayout {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 200px;
      background: #fff;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.06);
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      overflow-y: auto;
      z-index: 100;
    }

    .sidebarHeader {
      padding: 20px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .logo {
      font-size: 18px;
      font-weight: 600;
      color: #1890ff;
      text-decoration: none;
      display: block;
    }

    .menu {
      padding: 16px 0;
    }

    .menuItem {
      display: block;
      padding: 12px 24px;
      color: #262626;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menuItem:hover {
      background-color: #f0f0f0;
      color: #1890ff;
    }

    .menuItem.active {
      background-color: #e6f7ff;
      color: #1890ff;
      border-left-color: #1890ff;
      font-weight: 500;
    }

    .menuItemIcon {
      margin-right: 8px;
      font-size: 16px;
    }

    .menuGroup {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #f0f0f0;
    }

    .menuGroupTitle {
      padding: 8px 24px;
      font-size: 12px;
      color: #8c8c8c;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .mainContent {
      flex: 1;
      margin-left: 200px;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .dashboardPage {
      padding: 24px;
    }

    .pageHeader {
      background: #fff;
      padding: 16px 24px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .contentCard {
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .metricGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .metricCard {
      text-align: center;
      padding: 16px;
      border: 1px solid #f0f0f0;
      border-radius: 8px;
    }

    .metricLabel {
      font-size: 14px;
      color: #8c8c8c;
      margin-bottom: 8px;
    }

    .metricValue {
      font-size: 24px;
      font-weight: 600;
      color: #262626;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      .mainContent {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  
  <!-- Day.js -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  
  <!-- Ant Design JS -->
  <script src="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.js"></script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Card, Tabs, Typography, Statistic, Row, Col, Table, Tag, Space, Button, Form, InputNumber, message } = antd;
    const { Title } = Typography;
    const { TabPane } = Tabs;

    const DashboardManagement = () => {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [leaderboardConfig, setLeaderboardConfig] = useState({
        refreshInterval: 24,
        activeWeight: { login: 20, take: 20, submit: 20, deliver: 30 },
      });
      const [dashboardData, setDashboardData] = useState(null);

      useEffect(() => {
        loadDashboardData();
        loadLeaderboardConfig();
      }, []);

      const loadDashboardData = () => {
        // æ¨¡æ‹Ÿæ•°æ®
        const projects = JSON.parse(localStorage.getItem('adminProjects') || '[]');
        const orders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
        const students = JSON.parse(localStorage.getItem('talentPool') || '[]');

        const data = {
          supply: {
            publishedProjects: projects.filter(p => p.status === 'Published').length,
            availableProjects: projects.filter(p => p.status === 'Published' && p.quotaTaken < p.quotaTotal).length,
            takeRate: orders.length > 0 ? ((orders.filter(o => o.status !== 'ToBeTaken').length / orders.length) * 100).toFixed(1) : 0,
          },
          efficiency: {
            avgDeliveryCycle: 5.2,
            avgReviewCycle: 1.5,
            overdueOrders: orders.filter(o => {
              if (!o.dueTime) return false;
              return dayjs().isAfter(dayjs(o.dueTime)) && !['Accepted', 'Closed'].includes(o.status);
            }).length,
          },
          quality: {
            passRate: 85.5,
            avgRevisionRounds: 1.8,
            topRejectReasons: ['ç”»é¢è´¨é‡é—®é¢˜', 'éŸ³é¢‘åŒæ­¥é—®é¢˜', 'å­—å¹•è§„èŒƒé—®é¢˜'],
          },
          revenue: {
            acceptedOrders: orders.filter(o => o.status === 'Accepted').length,
            totalAmount: orders.filter(o => o.status === 'Accepted').reduce((sum, o) => sum + (o.amount || 0), 0),
            deductionAmount: 5000,
          },
          health: {
            activeStudents: students.filter(s => s.status === 'Active').length,
            fullCapacityStudents: students.filter(s => s.concurrencyUsed >= s.concurrencyLimit).length,
            abnormalList: orders.filter(o => {
              if (!o.dueTime) return false;
              return dayjs().isAfter(dayjs(o.dueTime)) && !['Accepted', 'Closed'].includes(o.status);
            }).slice(0, 5).map(o => ({
              orderId: o.id,
              projectName: o.projectName,
              taker: o.taker,
              reason: 'è¶…æœŸæœªäº¤ä»˜',
            })),
          },
        };

        setDashboardData(data);
      };

      const loadLeaderboardConfig = () => {
        const saved = JSON.parse(localStorage.getItem('leaderboardConfig') || 'null');
        if (saved) {
          setLeaderboardConfig(saved);
        }
      };

      const handleSaveConfig = () => {
        localStorage.setItem('leaderboardConfig', JSON.stringify(leaderboardConfig));
        message.success('é…ç½®å·²ä¿å­˜');
      };

      if (!dashboardData) {
        return (
          <div className="appLayout">
            <div className="sidebar" style={{ display: 'none' }}></div>
            <div className="mainContent" style={{ marginLeft: 0, display: 'flex', justifyContent: 'center', alignItems: 'center' }}>
              <div>åŠ è½½ä¸­...</div>
            </div>
          </div>
        );
      }

      return (
        <div className="appLayout">
          {/* å·¦ä¾§å¯¼èˆªæ  */}
          <div className="sidebar">
            <div className="sidebarHeader">
              <a href="Home.html" className="logo">ğŸ¬ å¤©åˆçŸ­å‰§å¹³å°</a>
            </div>
            <nav className="menu">
              <a href="Home.html" className="menuItem">
                <span className="menuItemIcon">ğŸ </span>
                é¦–é¡µ
              </a>
              <a href="ProjectHall.html" className="menuItem">
                <span className="menuItemIcon">ğŸ“‹</span>
                æ¥å•å¤§å…
              </a>
              <a href="Leaderboard.html" className="menuItem">
                <span className="menuItemIcon">ğŸ†</span>
                å¤©æ¢¯æ¦œå•
              </a>
              <a href="Account.html" className="menuItem">
                <span className="menuItemIcon">ğŸ’°</span>
                è´¦æˆ·ä¸æ”¶ç›Š
              </a>
              <a href="MyProjects.html" className="menuItem">
                <span className="menuItemIcon">ğŸš€</span>
                æˆ‘çš„é¡¹ç›®
              </a>
              
              <div className="menuGroup">
                <div className="menuGroupTitle">åå°ç®¡ç†</div>
                <a href="ReviewQueue.html" className="menuItem">
                  <span className="menuItemIcon">âœ…</span>
                  ä»»åŠ¡å®¡æ ¸
                </a>
                <a href="ProjectManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ“‹</span>
                  é¡¹ç›®ç®¡ç†
                </a>
                <a href="StudentManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ‘¥</span>
                  å­¦å‘˜ç®¡ç†
                </a>
                <a href="FinanceManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ’°</span>
                  è´¢åŠ¡å¯¹è´¦
                </a>
                <a href="DashboardManagement.html" className="menuItem active">
                  <span className="menuItemIcon">ğŸ“Š</span>
                  æ¦œå•ä¸æ•°æ®
                </a>
              </div>
            </nav>
          </div>

          {/* ä¸»å†…å®¹åŒº */}
          <div className="mainContent">
            <div className="dashboardPage">
              <div className="pageHeader">
                <Title level={2} style={{ margin: 0 }}>æ¦œå•ä¸æ•°æ®</Title>
              </div>

              <div className="contentCard">
                <Tabs activeKey={activeTab} onChange={setActiveTab}>
                  <TabPane tab="æ•°æ®çœ‹æ¿" key="dashboard">
                    {/* ä¾›éœ€ */}
                    <Title level={4}>ä¾›éœ€</Title>
                    <div className="metricGrid">
                      <div className="metricCard">
                        <div className="metricLabel">å‘å¸ƒé¡¹ç›®æ•°</div>
                        <div className="metricValue">{dashboardData.supply.publishedProjects}</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">å¯æ¥é¡¹ç›®æ•°</div>
                        <div className="metricValue">{dashboardData.supply.availableProjects}</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">æ¥å•è½¬åŒ–ç‡</div>
                        <div className="metricValue">{dashboardData.supply.takeRate}%</div>
                      </div>
                    </div>

                    {/* æ•ˆç‡ */}
                    <Title level={4}>æ•ˆç‡</Title>
                    <div className="metricGrid">
                      <div className="metricCard">
                        <div className="metricLabel">å¹³å‡äº¤ä»˜å‘¨æœŸï¼ˆå¤©ï¼‰</div>
                        <div className="metricValue">{dashboardData.efficiency.avgDeliveryCycle}</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">å¹³å‡å®¡æ ¸å‘¨æœŸï¼ˆå¤©ï¼‰</div>
                        <div className="metricValue">{dashboardData.efficiency.avgReviewCycle}</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">ä¸´æœŸ/è¶…æœŸè®¢å•æ•°</div>
                        <div className="metricValue" style={{ color: dashboardData.efficiency.overdueOrders > 0 ? '#ff4d4f' : '#52c41a' }}>
                          {dashboardData.efficiency.overdueOrders}
                        </div>
                      </div>
                    </div>

                    {/* è´¨é‡ */}
                    <Title level={4}>è´¨é‡</Title>
                    <div className="metricGrid">
                      <div className="metricCard">
                        <div className="metricLabel">é€šè¿‡ç‡</div>
                        <div className="metricValue">{dashboardData.quality.passRate}%</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">å¹³å‡ä¿®æ”¹è½®æ¬¡</div>
                        <div className="metricValue">{dashboardData.quality.avgRevisionRounds}</div>
                      </div>
                    </div>
                    <div style={{ marginTop: 16 }}>
                      <div style={{ marginBottom: 8 }}>é€€å›åŸå›  Top3ï¼š</div>
                      <Space>
                        {dashboardData.quality.topRejectReasons.map((reason, idx) => (
                          <Tag key={idx} color={idx === 0 ? 'red' : idx === 1 ? 'orange' : 'default'}>
                            {idx + 1}. {reason}
                          </Tag>
                        ))}
                      </Space>
                    </div>

                    {/* æ”¶ç›Š */}
                    <Title level={4}>æ”¶ç›Š</Title>
                    <div className="metricGrid">
                      <div className="metricCard">
                        <div className="metricLabel">éªŒæ”¶è®¢å•æ•°</div>
                        <div className="metricValue">{dashboardData.revenue.acceptedOrders}</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">åº”ä»˜é‡‘é¢</div>
                        <div className="metricValue">Â¥{dashboardData.revenue.totalAmount.toLocaleString()}</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">æ‰£æ¬¾è°ƒæ•´é‡‘é¢</div>
                        <div className="metricValue">Â¥{dashboardData.revenue.deductionAmount.toLocaleString()}</div>
                      </div>
                    </div>

                    {/* å¥åº·åº¦ */}
                    <Title level={4}>å¥åº·åº¦</Title>
                    <div className="metricGrid">
                      <div className="metricCard">
                        <div className="metricLabel">Active å­¦å‘˜æ•°</div>
                        <div className="metricValue">{dashboardData.health.activeStudents}</div>
                      </div>
                      <div className="metricCard">
                        <div className="metricLabel">æ»¡è½½äººæ•°</div>
                        <div className="metricValue">{dashboardData.health.fullCapacityStudents}</div>
                      </div>
                    </div>
                    {dashboardData.health.abnormalList.length > 0 && (
                      <div style={{ marginTop: 16 }}>
                        <div style={{ marginBottom: 8 }}>å¼‚å¸¸æ¸…å•ï¼š</div>
                        <Table
                          dataSource={dashboardData.health.abnormalList}
                          rowKey="orderId"
                          pagination={false}
                          size="small"
                          columns={[
                            { title: 'è®¢å•å·', dataIndex: 'orderId', key: 'orderId' },
                            { title: 'é¡¹ç›®å', dataIndex: 'projectName', key: 'projectName' },
                            { title: 'æ¥å•äºº', dataIndex: 'taker', key: 'taker' },
                            { title: 'å¼‚å¸¸åŸå› ', dataIndex: 'reason', key: 'reason', render: (reason) => <Tag color="red">{reason}</Tag> },
                          ]}
                        />
                      </div>
                    )}
                  </TabPane>

                  <TabPane tab="æ¦œå•è§„åˆ™é…ç½®" key="config">
                    <Form layout="vertical">
                      <Form.Item label="åˆ·æ–°ç­–ç•¥ï¼ˆå°æ—¶ï¼‰">
                        <InputNumber
                          min={1}
                          max={168}
                          value={leaderboardConfig.refreshInterval}
                          onChange={(value) => setLeaderboardConfig({ ...leaderboardConfig, refreshInterval: value })}
                        />
                        <div style={{ marginTop: 8, color: '#8c8c8c', fontSize: 12 }}>
                          æ¦œå•æ•°æ®åˆ·æ–°é—´éš”ï¼Œå»ºè®®è®¾ç½®ä¸º24å°æ—¶
                        </div>
                      </Form.Item>

                      <Title level={5}>è¿‘æœŸæ´»è·ƒåº¦æƒé‡é…ç½®</Title>
                      <Form.Item label="ç™»å½•æ¬¡æ•°æƒé‡ï¼ˆ%ï¼‰">
                        <InputNumber
                          min={0}
                          max={100}
                          value={leaderboardConfig.activeWeight.login}
                          onChange={(value) => setLeaderboardConfig({
                            ...leaderboardConfig,
                            activeWeight: { ...leaderboardConfig.activeWeight, login: value }
                          })}
                        />
                      </Form.Item>
                      <Form.Item label="æ¥å•é›†æ•°æƒé‡ï¼ˆ%ï¼‰">
                        <InputNumber
                          min={0}
                          max={100}
                          value={leaderboardConfig.activeWeight.take}
                          onChange={(value) => setLeaderboardConfig({
                            ...leaderboardConfig,
                            activeWeight: { ...leaderboardConfig.activeWeight, take: value }
                          })}
                        />
                      </Form.Item>
                      <Form.Item label="æäº¤é›†æ•°æƒé‡ï¼ˆ%ï¼‰">
                        <InputNumber
                          min={0}
                          max={100}
                          value={leaderboardConfig.activeWeight.submit}
                          onChange={(value) => setLeaderboardConfig({
                            ...leaderboardConfig,
                            activeWeight: { ...leaderboardConfig.activeWeight, submit: value }
                          })}
                        />
                      </Form.Item>
                      <Form.Item label="äº¤ä»˜é›†æ•°æƒé‡ï¼ˆ%ï¼‰">
                        <InputNumber
                          min={0}
                          max={100}
                          value={leaderboardConfig.activeWeight.deliver}
                          onChange={(value) => setLeaderboardConfig({
                            ...leaderboardConfig,
                            activeWeight: { ...leaderboardConfig.activeWeight, deliver: value }
                          })}
                        />
                      </Form.Item>

                      <Button type="primary" onClick={handleSaveConfig}>ä¿å­˜é…ç½®</Button>
                    </Form>
                  </TabPane>
                </Tabs>
              </div>
            </div>
          </div>
        </div>
      );
    };

    window.addEventListener('load', function() {
      try {
        ReactDOM.render(<DashboardManagement />, document.getElementById('root'));
      } catch (error) {
        console.error('æ¸²æŸ“é”™è¯¯:', error);
        document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">é¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ã€‚</div>';
      }
    });
  </script>
</body>
</html>
