<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¡¹ç›®ååŒç©ºé—´ - å¤©åˆçŸ­å‰§å‰ªè¾‘æ¥å•å¹³å°</title>
  
  <!-- Ant Design CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.css">
  
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .appLayout {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 200px;
      background: #fff;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.06);
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      overflow-y: auto;
      z-index: 100;
    }

    .sidebarHeader {
      padding: 20px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .logo {
      font-size: 18px;
      font-weight: 600;
      color: #1890ff;
      text-decoration: none;
      display: block;
    }

    .menu {
      padding: 16px 0;
    }

    .menuItem {
      display: block;
      padding: 12px 24px;
      color: #262626;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menuItem:hover {
      background-color: #f0f0f0;
      color: #1890ff;
    }

    .menuItem.active {
      background-color: #e6f7ff;
      color: #1890ff;
      border-left-color: #1890ff;
      font-weight: 500;
    }

    .menuItemIcon {
      margin-right: 8px;
      font-size: 16px;
    }

    .menuGroup {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #f0f0f0;
    }

    .menuGroupTitle {
      padding: 8px 24px;
      font-size: 12px;
      color: #8c8c8c;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }


    .mainContent {
      flex: 1;
      margin-left: 200px;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .projectSpace {
      padding: 24px;
    }

    .backButton {
      margin-bottom: 16px;
    }

    .headerCard {
      margin-bottom: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .projectTitle {
      margin: 0 0 8px 0;
      font-size: 20px;
      font-weight: 600;
      color: #262626;
    }

    .orderInfo {
      color: #8c8c8c;
      font-size: 14px;
    }

    .contentCard {
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      background: #fff;
    }

    .statusTag {
      font-size: 14px;
      padding: 4px 12px;
      border-radius: 4px;
    }

    .statusTag.processing {
      background: #e6f7ff;
      color: #1890ff;
      border: 1px solid #91d5ff;
    }

    .statusTag.submitted {
      background: #f6ffed;
      color: #52c41a;
      border: 1px solid #b7eb8f;
    }

    .statusTag.approved {
      background: #f6ffed;
      color: #52c41a;
      border: 1px solid #b7eb8f;
    }

    .statusTag.revision {
      background: #fff7e6;
      color: #fa8c16;
      border: 1px solid #ffd591;
    }

    .statusTag.accepted {
      background: #f6ffed;
      color: #52c41a;
      border: 1px solid #b7eb8f;
    }

    .versionCard {
      border: 1px solid #f0f0f0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      transition: all 0.3s;
    }

    .versionCard:hover {
      border-color: #1890ff;
      box-shadow: 0 2px 8px rgba(24, 144, 255, 0.1);
    }

    .versionCard.current {
      border-color: #52c41a;
      background: #f6ffed;
    }

    .timelineItem {
      padding: 16px;
      border-left: 2px solid #f0f0f0;
      margin-left: 20px;
      margin-bottom: 16px;
      position: relative;
    }

    .timelineItem::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 20px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #1890ff;
    }

    .timelineItem.revision::before {
      background: #fa8c16;
    }

    .timelineItem.approved::before {
      background: #52c41a;
    }

    .uploadArea {
      border: 2px dashed #d9d9d9;
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.3s;
    }

    .uploadArea:hover {
      border-color: #1890ff;
      background: #e6f7ff;
    }

    .memberAvatar {
      margin-right: 8px;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      .mainContent {
        margin-left: 0;
      }

      .projectSpace {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  
  <!-- Day.js -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  
  <!-- Ant Design JS -->
  <script src="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.js"></script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { Card, Tag, Button, Tabs, Descriptions, Space, Typography, List, Avatar, Upload, Timeline, Input, message, Modal, Select, Form } = antd;
    const { TabPane } = Tabs;
    const { Title, Text } = Typography;
    const { TextArea } = Input;
    const { Option } = Select;

    // è·å– URL å‚æ•°
    function getUrlParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // ä» localStorage è¯»å–æˆ–åˆå§‹åŒ–è®¢å•ç©ºé—´æ•°æ®
    function getOrderSpaceData(orderId) {
      const key = `orderSpace_${orderId}`;
      const stored = localStorage.getItem(key);
      if (stored) {
        return JSON.parse(stored);
      }
      return null;
    }

    // ä¿å­˜è®¢å•ç©ºé—´æ•°æ®åˆ° localStorage
    function saveOrderSpaceData(orderId, data) {
      const key = `orderSpace_${orderId}`;
      localStorage.setItem(key, JSON.stringify(data));
    }

    // åˆå§‹åŒ–è®¢å•ç©ºé—´æ•°æ®
    function initOrderSpaceData(orderId, orderInfo) {
      // ä»é¡¹ç›®æ•°æ®ä¸­è·å–åŸºç¡€ä¿¡æ¯ï¼ˆå¦‚æœorderInfoä¸­æ²¡æœ‰ï¼‰
      let projectInfo = {};
      if (orderInfo.projectId) {
        // å°è¯•ä»mockProjectsä¸­è·å–é¡¹ç›®ä¿¡æ¯
        const mockProjects = JSON.parse(localStorage.getItem('mockProjects') || '[]');
        const project = mockProjects.find(p => p.id === orderInfo.projectId);
        if (project) {
          projectInfo = {
            category: project.category,
            projectTags: project.projectTags || [],
            contentGenre: project.contentGenre,
            difficulty: project.difficulty,
            participantTeam: project.participantTeam,
            deliveryCycleDays: project.deliveryCycleDays,
            takeMode: project.takeMode,
            quotaTotal: project.quotaTotal,
          };
        }
      }
      
      const defaultData = {
        orderId: orderId,
        projectId: orderInfo.projectId,
        projectName: orderInfo.projectName,
        // é¡¹ç›®åŸºç¡€ä¿¡æ¯
        category: projectInfo.category || orderInfo.category || 'çŸ­å‰§',
        projectTags: projectInfo.projectTags || orderInfo.projectTags || [],
        contentGenre: projectInfo.contentGenre || orderInfo.contentGenre || '',
        difficulty: projectInfo.difficulty || orderInfo.difficulty || 'å·¥å‚',
        participantTeam: projectInfo.participantTeam || orderInfo.participantTeam || 'çº¿ä¸Š',
        deliveryCycleDays: projectInfo.deliveryCycleDays || orderInfo.deliveryCycleDays || 7,
        takeMode: projectInfo.takeMode || orderInfo.takeMode || 'æŠ¢å•',
        quotaTotal: projectInfo.quotaTotal || orderInfo.quotaTotal || 1,
        // è®¢å•ä¿¡æ¯
        status: orderInfo.status || 'InProgress',
        takeTime: orderInfo.takeTime,
        dueTime: orderInfo.dueTime,
        unitPrice: orderInfo.unitPrice,
        episodeCount: orderInfo.episodeCount,
        members: [
          { id: '1', name: 'å½“å‰ç”¨æˆ·', role: 'å­¦å‘˜', avatar: 'ğŸ‘¤' },
          { id: '2', name: 'æè¿è¥', role: 'è¿è¥', avatar: 'ğŸ‘¨â€ğŸ’¼' },
          { id: '3', name: 'ç‹å®¡æ ¸', role: 'å®¡æ ¸', avatar: 'ğŸ‘©â€ğŸ’¼' },
        ],
        materials: [
          { id: '1', name: 'åŸå§‹ç´ æ_ç¬¬01-05é›†.zip', size: 1073741824, type: 'zip' },
          { id: '2', name: 'BGMéŸ³ä¹åº“.zip', size: 524288000, type: 'zip' },
          { id: '3', name: 'å­—å¹•æ¨¡æ¿.srt', size: 102400, type: 'srt' },
        ],
        deliveries: [],
        revisions: [],
        messages: [],
      };
      saveOrderSpaceData(orderId, defaultData);
      return defaultData;
    }

    // æ›´æ–°è®¢å•çŠ¶æ€
    function updateOrderStatus(orderId, newStatus) {
      const orders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
      const orderIndex = orders.findIndex(o => o.orderId === orderId);
      if (orderIndex !== -1) {
        orders[orderIndex].status = newStatus;
        localStorage.setItem('currentOrders', JSON.stringify(orders));
      }
      
      // åŒæ—¶æ›´æ–°ç©ºé—´æ•°æ®
      const spaceData = getOrderSpaceData(orderId);
      if (spaceData) {
        spaceData.status = newStatus;
        saveOrderSpaceData(orderId, spaceData);
      }
    }

    const ProjectSpace = () => {
      const [activeTab, setActiveTab] = useState('overview');
      const [orderData, setOrderData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [uploadModalVisible, setUploadModalVisible] = useState(false);
      const [changeNote, setChangeNote] = useState('');
      const [messageContent, setMessageContent] = useState('');
      const [revisionForm] = Form.useForm();
      const [revisionModalVisible, setRevisionModalVisible] = useState(false);
      const [selectedVersion, setSelectedVersion] = useState('');
      const [messageImages, setMessageImages] = useState([]);
      const orderId = getUrlParam('orderId');
      const projectId = getUrlParam('projectId');

      useEffect(() => {
        if (!orderId) {
          setLoading(false);
          return;
        }

        // ä» localStorage è¯»å–è®¢å•ä¿¡æ¯
        const orders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
        const orderInfo = orders.find(o => o.orderId === orderId);

        if (!orderInfo) {
          setLoading(false);
          return;
        }

        // è¯»å–æˆ–åˆå§‹åŒ–ç©ºé—´æ•°æ®
        let spaceData = getOrderSpaceData(orderId);
        if (!spaceData) {
          spaceData = initOrderSpaceData(orderId, orderInfo);
        } else {
          // ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„æ•°ç»„å­—æ®µéƒ½å­˜åœ¨ï¼Œé¿å… undefined
          if (!Array.isArray(spaceData.deliveries)) spaceData.deliveries = [];
          if (!Array.isArray(spaceData.revisions)) spaceData.revisions = [];
          if (!Array.isArray(spaceData.members)) {
            spaceData.members = [
              { id: '1', name: 'å½“å‰ç”¨æˆ·', role: 'å­¦å‘˜', avatar: 'ğŸ‘¤' },
              { id: '2', name: 'æè¿è¥', role: 'è¿è¥', avatar: 'ğŸ‘¨â€ğŸ’¼' },
              { id: '3', name: 'ç‹å®¡æ ¸', role: 'å®¡æ ¸', avatar: 'ğŸ‘©â€ğŸ’¼' },
            ];
          }
          if (!Array.isArray(spaceData.materials)) {
            spaceData.materials = [
              { id: '1', name: 'åŸå§‹ç´ æ_ç¬¬01-05é›†.zip', size: 1073741824, type: 'zip' },
              { id: '2', name: 'BGMéŸ³ä¹åº“.zip', size: 524288000, type: 'zip' },
              { id: '3', name: 'å­—å¹•æ¨¡æ¿.srt', size: 102400, type: 'srt' },
            ];
          }
          if (!Array.isArray(spaceData.messages)) spaceData.messages = [];
          if (!Array.isArray(spaceData.projectTags)) spaceData.projectTags = [];
          
          // åŒæ­¥è®¢å•çŠ¶æ€å’Œé¡¹ç›®åŸºç¡€ä¿¡æ¯ï¼ˆå¦‚æœè®¢å•ä¿¡æ¯ä¸­æœ‰ï¼‰
          spaceData.status = orderInfo.status || spaceData.status || 'InProgress';
          if (orderInfo.category) spaceData.category = orderInfo.category;
          if (orderInfo.projectTags) spaceData.projectTags = orderInfo.projectTags;
          if (orderInfo.contentGenre) spaceData.contentGenre = orderInfo.contentGenre;
          if (orderInfo.difficulty) spaceData.difficulty = orderInfo.difficulty;
          if (orderInfo.participantTeam) spaceData.participantTeam = orderInfo.participantTeam;
          if (orderInfo.deliveryCycleDays) spaceData.deliveryCycleDays = orderInfo.deliveryCycleDays;
          if (orderInfo.takeMode) spaceData.takeMode = orderInfo.takeMode;
          if (orderInfo.quotaTotal) spaceData.quotaTotal = orderInfo.quotaTotal;
          
          // ç¡®ä¿é¡¹ç›®IDå’Œåç§°å­˜åœ¨
          if (!spaceData.projectId) spaceData.projectId = orderInfo.projectId;
          if (!spaceData.projectName) spaceData.projectName = orderInfo.projectName;
          
          saveOrderSpaceData(orderId, spaceData);
        }

        setOrderData(spaceData);
        setLoading(false);
      }, [orderId]);

      const formatFileSize = (bytes) => {
        if (!bytes) return '-';
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
        if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        return (bytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
      };

      const getStatusText = (status) => {
        const statusMap = {
          'InProgress': 'è¿›è¡Œä¸­',
          'Submitted': 'å·²æäº¤',
          'NeedRevision': 'é€€å›ä¿®æ”¹',
          'Approved': 'å®¡æ ¸é€šè¿‡',
          'Accepted': 'å·²éªŒæ”¶',
        };
        return statusMap[status] || status;
      };

      const getStatusClass = (status) => {
        const classMap = {
          'InProgress': 'processing',
          'Submitted': 'submitted',
          'NeedRevision': 'revision',
          'Approved': 'approved',
          'Accepted': 'accepted',
        };
        return classMap[status] || '';
      };

      const formatDueTime = (dueTime) => {
        const date = dayjs(dueTime);
        const now = dayjs();
        const diff = date.diff(now, 'day');
        if (diff < 0) return 'å·²è¶…æœŸ';
        if (diff === 0) return 'ä»Šæ—¥æˆªæ­¢';
        if (diff === 1) return 'æ˜æ—¥æˆªæ­¢';
        return `${diff}å¤©åæˆªæ­¢`;
      };

      // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
      const handleUpload = (file) => {
        setUploadModalVisible(true);
        return false; // é˜»æ­¢è‡ªåŠ¨ä¸Šä¼ 
      };

      // ç¡®è®¤ä¸Šä¼ äº¤ä»˜æ–‡ä»¶
      const handleConfirmUpload = () => {
        if (!changeNote.trim()) {
          message.warning('è¯·è¾“å…¥å˜æ›´è¯´æ˜');
          return;
        }

        const nextVersion = `V${orderData.deliveries.length + 1}`;
        const newDelivery = {
          id: `delivery_${Date.now()}`,
          version: nextVersion,
          fileName: `${orderData.projectName}_${nextVersion}.zip`,
          uploadTime: dayjs().format('YYYY-MM-DD HH:mm:ss'),
          uploader: 'å½“å‰ç”¨æˆ·',
          changeNote: changeNote,
          status: 'Submitted',
          fileSize: Math.floor(Math.random() * 1000000000) + 100000000, // æ¨¡æ‹Ÿæ–‡ä»¶å¤§å°
        };

        const updatedData = {
          ...orderData,
          deliveries: [...orderData.deliveries, newDelivery],
          status: 'Submitted',
        };

        setOrderData(updatedData);
        saveOrderSpaceData(orderId, updatedData);
        updateOrderStatus(orderId, 'Submitted');
        
        setUploadModalVisible(false);
        setChangeNote('');
        message.success('äº¤ä»˜æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼');
      };

      // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
      const handleImageUpload = (file) => {
        const isImage = file.type.startsWith('image/');
        if (!isImage) {
          message.error('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
          return false;
        }
        const isLt10M = file.size / 1024 / 1024 < 10;
        if (!isLt10M) {
          message.error('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 10MBï¼');
          return false;
        }
        
        // åˆ›å»ºé¢„è§ˆURL
        const reader = new FileReader();
        reader.onload = (e) => {
          const imageUrl = e.target.result;
          setMessageImages([...messageImages, {
            uid: file.uid,
            name: file.name,
            url: imageUrl,
            status: 'done',
          }]);
        };
        reader.readAsDataURL(file);
        return false; // é˜»æ­¢è‡ªåŠ¨ä¸Šä¼ 
      };

      // ç§»é™¤å›¾ç‰‡
      const handleRemoveImage = (file) => {
        setMessageImages(messageImages.filter(img => img.uid !== file.uid));
      };

      // å‘é€æ¶ˆæ¯
      const handleSendMessage = () => {
        if (!messageContent.trim() && messageImages.length === 0) {
          message.warning('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹æˆ–ä¸Šä¼ å›¾ç‰‡');
          return;
        }

        const newMessage = {
          id: `msg_${Date.now()}`,
          sender: 'å½“å‰ç”¨æˆ·',
          content: messageContent,
          images: messageImages.map(img => ({
            name: img.name,
            url: img.url,
          })),
          time: dayjs().format('YYYY-MM-DD HH:mm:ss'),
        };

        const updatedData = {
          ...orderData,
          messages: [...orderData.messages, newMessage],
        };

        setOrderData(updatedData);
        saveOrderSpaceData(orderId, updatedData);
        setMessageContent('');
        setMessageImages([]);
        message.success('æ¶ˆæ¯å‘é€æˆåŠŸï¼');
      };

      // æ‰“å¼€æ·»åŠ ä¿®æ”¹æ„è§å¼¹çª—
      const handleOpenRevisionModal = (version) => {
        setSelectedVersion(version);
        revisionForm.setFieldsValue({ version: version });
        setRevisionModalVisible(true);
      };

      // å…³é—­ä¿®æ”¹æ„è§å¼¹çª—
      const handleCloseRevisionModal = () => {
        setRevisionModalVisible(false);
        setSelectedVersion('');
        revisionForm.resetFields();
      };

      // æ·»åŠ ä¿®æ”¹æ„è§ï¼ˆæ¨¡æ‹Ÿå®¡æ ¸é€€å›ï¼‰
      const handleAddRevision = (values) => {
        // ç¡®ä¿ deliveries å’Œ revisions æ˜¯æ•°ç»„
        const deliveries = orderData.deliveries || [];
        const revisions = orderData.revisions || [];
        
        // æ ¹æ®é€‰æ‹©çš„ç‰ˆæœ¬æ‰¾åˆ°å¯¹åº”çš„äº¤ä»˜è®°å½•
        const selectedDelivery = deliveries.find(d => d.version === values.version);
        if (!selectedDelivery) {
          message.error('æœªæ‰¾åˆ°å¯¹åº”çš„äº¤ä»˜ç‰ˆæœ¬');
          return;
        }

        const newRevision = {
          id: `revision_${Date.now()}`,
          version: values.version,
          type: 'revision',
          reason: values.reason,
          content: values.content,
          reviewer: 'ç‹å®¡æ ¸',
          reviewTime: dayjs().format('YYYY-MM-DD HH:mm:ss'),
        };

        // æ›´æ–°å¯¹åº”ç‰ˆæœ¬çš„çŠ¶æ€ä¸ºéœ€è¦ä¿®æ”¹ï¼ˆå¦‚æœä¹‹å‰æ˜¯å·²é€šè¿‡çŠ¶æ€ï¼Œåˆ™ä¿æŒï¼Œå…è®¸å¯¹å·²é€šè¿‡çš„ç‰ˆæœ¬ç»§ç»­æ·»åŠ æ„è§ï¼‰
        const updatedDeliveries = deliveries.map(d => 
          d.version === values.version && d.status !== 'Approved' ? { ...d, status: 'NeedRevision' } : d
        );

        const updatedData = {
          ...orderData,
          deliveries: updatedDeliveries,
          revisions: [...revisions, newRevision],
          // å¦‚æœè®¢å•çŠ¶æ€æ˜¯å·²é€šè¿‡ï¼Œæ·»åŠ ä¿®æ”¹æ„è§åä¸æ”¹å˜è®¢å•çŠ¶æ€
          status: orderData.status === 'Approved' ? orderData.status : 'NeedRevision',
        };

        setOrderData(updatedData);
        saveOrderSpaceData(orderId, updatedData);
        if (orderData.status !== 'Approved') {
          updateOrderStatus(orderId, 'NeedRevision');
        }
        revisionForm.resetFields();
        handleCloseRevisionModal();
        message.success('ä¿®æ”¹æ„è§å·²æ·»åŠ ');
      };

      // å®¡æ ¸é€šè¿‡
      const handleApprove = () => {
        Modal.confirm({
          title: 'ç¡®è®¤å®¡æ ¸é€šè¿‡',
          content: 'ç¡®å®šè¦å®¡æ ¸é€šè¿‡å½“å‰äº¤ä»˜ç‰ˆæœ¬å—ï¼Ÿ',
          onOk: () => {
            const deliveries = orderData.deliveries || [];
            if (deliveries.length === 0) {
              message.error('æ²¡æœ‰å¯å®¡æ ¸çš„äº¤ä»˜ç‰ˆæœ¬');
              return;
            }
            const latestDelivery = deliveries[deliveries.length - 1];
            const updatedDeliveries = deliveries.map(d => 
              d.id === latestDelivery.id ? { ...d, status: 'Approved' } : d
            );

            const newRevision = {
              id: `revision_${Date.now()}`,
              version: latestDelivery.version,
              type: 'approved',
              reason: 'å®¡æ ¸é€šè¿‡',
              content: 'äº¤ä»˜æ–‡ä»¶ç¬¦åˆè¦æ±‚ï¼Œå®¡æ ¸é€šè¿‡',
              reviewer: 'ç‹å®¡æ ¸',
              reviewTime: dayjs().format('YYYY-MM-DD HH:mm:ss'),
            };

            const updatedData = {
              ...orderData,
              deliveries: updatedDeliveries,
              revisions: [...orderData.revisions, newRevision],
              status: 'Approved',
            };

            setOrderData(updatedData);
            saveOrderSpaceData(orderId, updatedData);
            updateOrderStatus(orderId, 'Approved');
            message.success('å®¡æ ¸é€šè¿‡ï¼');
          },
        });
      };

      // ç”³è¯·éªŒæ”¶
      const handleAccept = () => {
        Modal.confirm({
          title: 'ç¡®è®¤éªŒæ”¶',
          content: 'ç¡®å®šè¦ç”³è¯·éªŒæ”¶å—ï¼ŸéªŒæ”¶åå°†è®¡å…¥æ”¶ç›Šã€‚',
          onOk: () => {
            const updatedData = {
              ...orderData,
              status: 'Accepted',
            };

            setOrderData(updatedData);
            saveOrderSpaceData(orderId, updatedData);
            updateOrderStatus(orderId, 'Accepted');
            
            // åˆ›å»ºæ”¶ç›Šè®°å½•
            const earnings = JSON.parse(localStorage.getItem('earnings') || '[]');
            const totalAmount = orderData.unitPrice * orderData.episodeCount;
            earnings.push({
              orderId: orderId,
              projectName: orderData.projectName,
              amount: totalAmount,
              acceptTime: dayjs().format('YYYY-MM-DD HH:mm:ss'),
              status: 'æœªç»“ç®—',
              settlementMonth: dayjs().format('YYYY-MM'),
            });
            localStorage.setItem('earnings', JSON.stringify(earnings));
            
            message.success('éªŒæ”¶æˆåŠŸï¼æ”¶ç›Šå·²å…¥è´¦ã€‚');
          },
        });
      };

      if (loading) {
        return (
          <div className="appLayout">
            <div className="sidebar">
              <div className="sidebarHeader">
                <a href="Home.html" className="logo">ğŸ¬ å¤©åˆçŸ­å‰§å¹³å°</a>
              </div>
              <nav className="menu">
                <a href="Home.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ </span>
                  é¦–é¡µ
                </a>
                <a href="ProjectHall.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ“‹</span>
                  æ¥å•å¤§å…
                </a>
                <a href="ProjectHall.html?tab=leaderboard" className="menuItem">
                  <span className="menuItemIcon">ğŸ†</span>
                  å¤©æ¢¯æ¦œå•
                </a>
                <a href="Account.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ’°</span>
                  è´¦æˆ·ä¸æ”¶ç›Š
                </a>
              </nav>
            </div>
            <div className="mainContent">
              <div style={{ textAlign: 'center', padding: '60px 20px' }}>åŠ è½½ä¸­...</div>
            </div>
          </div>
        );
      }

      if (!orderData) {
        return (
          <div className="appLayout">
            <div className="sidebar">
              <div className="sidebarHeader">
                <a href="Home.html" className="logo">ğŸ¬ å¤©åˆçŸ­å‰§å¹³å°</a>
              </div>
              <nav className="menu">
                <a href="Home.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ </span>
                  é¦–é¡µ
                </a>
                <a href="ProjectHall.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ“‹</span>
                  æ¥å•å¤§å…
                </a>
                <a href="ProjectHall.html?tab=leaderboard" className="menuItem">
                  <span className="menuItemIcon">ğŸ†</span>
                  å¤©æ¢¯æ¦œå•
                </a>
                <a href="Account.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ’°</span>
                  è´¦æˆ·ä¸æ”¶ç›Š
                </a>
              </nav>
            </div>
            <div className="mainContent">
              <div style={{ textAlign: 'center', padding: '60px 20px', color: '#ff4d4f' }}>è®¢å•ä¸å­˜åœ¨</div>
            </div>
          </div>
        );
      }

      return (
        <div className="appLayout">
          {/* å·¦ä¾§å¯¼èˆªæ  */}
          <div className="sidebar">
            <div className="sidebarHeader">
              <a href="Home.html" className="logo">ğŸ¬ å¤©åˆçŸ­å‰§å¹³å°</a>
            </div>
            <nav className="menu">
              <a href="Home.html" className="menuItem">
                <span className="menuItemIcon">ğŸ </span>
                é¦–é¡µ
              </a>
              <a href="ProjectHall.html" className="menuItem">
                <span className="menuItemIcon">ğŸ“‹</span>
                æ¥å•å¤§å…
              </a>
              <a href="ProjectHall.html?tab=leaderboard" className="menuItem">
                <span className="menuItemIcon">ğŸ†</span>
                å¤©æ¢¯æ¦œå•
              </a>
              <a href="Account.html" className="menuItem">
                <span className="menuItemIcon">ğŸ’°</span>
                è´¦æˆ·ä¸æ”¶ç›Š
              </a>
              <a href="MyProjects.html" className="menuItem">
                <span className="menuItemIcon">ğŸš€</span>
                æˆ‘çš„é¡¹ç›®
              </a>
              
              <div className="menuGroup">
                <div className="menuGroupTitle">åå°ç®¡ç†</div>
                <a href="ReviewQueue.html" className="menuItem">
                  <span className="menuItemIcon">âœ…</span>
                  å†…å®¹å®¡æ ¸
                </a>
                <a href="ProjectManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ“‹</span>
                  é¡¹ç›®ç®¡ç†
                </a>
                <a href="StudentManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ‘¥</span>
                  å­¦å‘˜ç®¡ç†
                </a>
                <a href="FinanceManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ’°</span>
                  è´¢åŠ¡å¯¹è´¦
                </a>
                <a href="DashboardManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ“Š</span>
                  æ¦œå•ä¸æ•°æ®
                </a>
              </div>
            </nav>
          </div>

          {/* ä¸»å†…å®¹åŒº */}
          <div className="mainContent">
            <div className="projectSpace">
            <div className="backButton">
              <Button onClick={() => window.location.href = 'ProjectHall.html'}>
                â† è¿”å›æ¥å•å¤§å…
              </Button>
            </div>

            <Card className="headerCard">
              <Title level={3} className="projectTitle">{orderData.projectName}</Title>
              <div className="orderInfo">
                è®¢å•å·ï¼š{orderData.orderId} | 
                æ¥å•æ—¶é—´ï¼š{dayjs(orderData.takeTime).format('YYYY-MM-DD HH:mm:ss')} | 
                æˆªæ­¢æ—¶é—´ï¼š{dayjs(orderData.dueTime).format('YYYY-MM-DD HH:mm:ss')} 
                <span style={{ color: '#fa8c16', marginLeft: '8px' }}>
                  ({formatDueTime(orderData.dueTime)})
                </span>
              </div>
              <div style={{ marginTop: '12px' }}>
                <span className={`statusTag ${getStatusClass(orderData.status)}`}>
                  {getStatusText(orderData.status)}
                </span>
              </div>
            </Card>

            <Card className="contentCard">
              <Tabs activeKey={activeTab} onChange={setActiveTab}>
                <TabPane tab="ğŸ“Š æ¦‚è§ˆ" key="overview">
                  <Descriptions column={2} bordered style={{ marginTop: 16 }}>
                    <Descriptions.Item label="è®¢å•å·">{orderData.orderId}</Descriptions.Item>
                    <Descriptions.Item label="é¡¹ç›®åç§°">{orderData.projectName}</Descriptions.Item>
                    <Descriptions.Item label="å†…å®¹åˆ†ç±»">
                      <Tag color="blue">{orderData.category || 'çŸ­å‰§'}</Tag>
                    </Descriptions.Item>
                    <Descriptions.Item label="é¡¹ç›®æ ‡ç­¾">
                      <Space size="small" wrap>
                        {orderData.projectTags && orderData.projectTags.length > 0 ? (
                          orderData.projectTags.map((tag, index) => (
                            <Tag key={index}>{tag}</Tag>
                          ))
                        ) : (
                          <span style={{ color: '#8c8c8c' }}>æ— </span>
                        )}
                      </Space>
                    </Descriptions.Item>
                    <Descriptions.Item label="å†…å®¹ç±»åˆ«">
                      <Tag color="purple">{orderData.contentGenre || '-'}</Tag>
                    </Descriptions.Item>
                    <Descriptions.Item label="éš¾åº¦">
                      <Tag color={orderData.difficulty === 'ç²¾å“' ? 'gold' : 'default'}>
                        {orderData.difficulty || 'å·¥å‚'}
                      </Tag>
                    </Descriptions.Item>
                    <Descriptions.Item label="å‚ä¸å›¢é˜Ÿ">
                      {orderData.participantTeam || 'çº¿ä¸Š'}
                    </Descriptions.Item>
                    <Descriptions.Item label="äº¤ä»˜å‘¨æœŸ">
                      {orderData.deliveryCycleDays || 7}å¤©
                    </Descriptions.Item>
                    <Descriptions.Item label="æ¥å•æ¨¡å¼">
                      <Tag color={orderData.takeMode === 'æŠ¢å•' ? 'green' : 'orange'}>
                        {orderData.takeMode || 'æŠ¢å•'}
                      </Tag>
                    </Descriptions.Item>
                    <Descriptions.Item label="åé¢">
                      {orderData.quotaTotal || 1}äºº
                    </Descriptions.Item>
                    <Descriptions.Item label="è®¢å•çŠ¶æ€">
                      <span className={`statusTag ${getStatusClass(orderData.status)}`}>
                        {getStatusText(orderData.status)}
                      </span>
                    </Descriptions.Item>
                    <Descriptions.Item label="æ¥å•æ—¶é—´">
                      {dayjs(orderData.takeTime).format('YYYY-MM-DD HH:mm:ss')}
                    </Descriptions.Item>
                    <Descriptions.Item label="æˆªæ­¢æ—¶é—´">
                      {dayjs(orderData.dueTime).format('YYYY-MM-DD HH:mm:ss')}
                      <span style={{ color: '#fa8c16', marginLeft: '8px' }}>
                        ({formatDueTime(orderData.dueTime)})
                      </span>
                    </Descriptions.Item>
                    <Descriptions.Item label="å•ä»·">
                      Â¥{orderData.unitPrice}/é›†
                    </Descriptions.Item>
                    <Descriptions.Item label="é›†æ•°">{orderData.episodeCount}é›†</Descriptions.Item>
                    <Descriptions.Item label="æ€»é‡‘é¢">
                      <span style={{ color: '#52c41a', fontWeight: 600 }}>
                        Â¥{orderData.unitPrice * orderData.episodeCount}
                      </span>
                    </Descriptions.Item>
                    <Descriptions.Item label="ç©ºé—´æˆå‘˜" span={2}>
                      <Space>
                        {orderData.members.map((member) => (
                          <Space key={member.id}>
                            <Avatar>{member.avatar}</Avatar>
                            <span>{member.name}</span>
                            <Tag>{member.role}</Tag>
                          </Space>
                        ))}
                      </Space>
                    </Descriptions.Item>
                  </Descriptions>
                </TabPane>

                <TabPane tab="ğŸ“¦ ç´ æ" key="materials">
                  <List
                    dataSource={orderData.materials}
                    renderItem={(item) => (
                      <List.Item>
                        <List.Item.Meta
                          avatar={<span style={{ fontSize: 24 }}>ğŸ“¦</span>}
                          title={<a href="#" download>{item.name}</a>}
                          description={`å¤§å°: ${formatFileSize(item.size)} | ç±»å‹: ${item.type || 'æœªçŸ¥'}`}
                        />
                        <Button type="primary" href="#" download>
                          ä¸‹è½½
                        </Button>
                      </List.Item>
                    )}
                    style={{ marginTop: 16 }}
                  />
                </TabPane>

                <TabPane tab="ğŸ“¤ äº¤ä»˜ä¸ä¿®æ”¹" key="deliveries">
                  <div style={{ marginTop: 16 }}>
                    {(!orderData.deliveries || orderData.deliveries.length === 0) ? (
                      <div className="uploadArea">
                        <div style={{ fontSize: 48, marginBottom: 16 }}>ğŸ“¤</div>
                        <div style={{ fontSize: 16, color: '#8c8c8c' }}>æš‚æ— äº¤ä»˜æ–‡ä»¶</div>
                      </div>
                    ) : (
                      orderData.deliveries.map((delivery) => {
                        // è·å–è¯¥ç‰ˆæœ¬å¯¹åº”çš„ä¿®æ”¹æ„è§
                        const versionRevisions = (orderData.revisions || [])
                          .filter(r => r.version === delivery.version)
                          .sort((a, b) => dayjs(a.reviewTime).valueOf() - dayjs(b.reviewTime).valueOf());
                        
                        return (
                          <div key={delivery.id} className={`versionCard ${delivery.status === 'Approved' ? 'current' : ''}`} style={{ marginBottom: 24 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                              <Space>
                                <Tag color="blue">{delivery.version}</Tag>
                                <span style={{ fontWeight: 500 }}>{delivery.fileName}</span>
                                <span className={`statusTag ${getStatusClass(delivery.status)}`}>
                                  {getStatusText(delivery.status)}
                                </span>
                              </Space>
                              <Space>
                                <Button type="link" href="#" download>ä¸‹è½½</Button>
                                <Button 
                                  type="link" 
                                  onClick={() => handleOpenRevisionModal(delivery.version)}
                                  style={{ color: '#1890ff' }}
                                >
                                  ğŸ’¬ æ·»åŠ ä¿®æ”¹æ„è§
                                </Button>
                              </Space>
                            </div>
                            <div style={{ color: '#8c8c8c', fontSize: 12, marginBottom: 8 }}>
                              ä¸Šä¼ æ—¶é—´ï¼š{dayjs(delivery.uploadTime).format('YYYY-MM-DD HH:mm:ss')} | 
                              ä¸Šä¼ äººï¼š{delivery.uploader} | 
                              å¤§å°ï¼š{formatFileSize(delivery.fileSize)}
                            </div>
                            {delivery.changeNote && (
                              <div style={{ color: '#595959', fontSize: 13, marginBottom: 12 }}>
                                å˜æ›´è¯´æ˜ï¼š{delivery.changeNote}
                              </div>
                            )}
                            
                            {/* æ˜¾ç¤ºè¯¥ç‰ˆæœ¬çš„ä¿®æ”¹æ„è§ */}
                            {versionRevisions.length > 0 && (
                              <div style={{ 
                                marginTop: 16, 
                                padding: '16px', 
                                background: '#fafafa', 
                                borderRadius: '6px',
                                border: '1px solid #e8e8e8'
                              }}>
                                <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 12, color: '#262626' }}>
                                  ğŸ’¬ ä¿®æ”¹æ„è§
                                </div>
                                <Timeline style={{ marginTop: 8 }}>
                                  {versionRevisions.map((revision) => (
                                    <Timeline.Item key={revision.id}>
                                      <div className={`timelineItem ${revision.type}`}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
                                          <Space>
                                            <Tag color={revision.type === 'approved' ? 'green' : 'orange'}>
                                              {revision.type === 'approved' ? 'å®¡æ ¸é€šè¿‡' : 'é€€å›ä¿®æ”¹'}
                                            </Tag>
                                          </Space>
                                          <span style={{ color: '#8c8c8c', fontSize: 12 }}>
                                            {dayjs(revision.reviewTime).format('YYYY-MM-DD HH:mm:ss')}
                                          </span>
                                        </div>
                                        <div style={{ marginBottom: 8 }}>
                                          <Text strong>é€€å›åŸå› ï¼š</Text>
                                          <Text>{revision.reason}</Text>
                                        </div>
                                        <div>
                                          <Text strong>ä¿®æ”¹ç‚¹ï¼š</Text>
                                          <Text>{revision.content}</Text>
                                        </div>
                                        <div style={{ marginTop: 8, color: '#8c8c8c', fontSize: 12 }}>
                                          å®¡æ ¸äººï¼š{revision.reviewer}
                                        </div>
                                      </div>
                                    </Timeline.Item>
                                  ))}
                                </Timeline>
                              </div>
                            )}
                          </div>
                        );
                      })
                    )}
                    
                    {/* æ·»åŠ ä¿®æ”¹æ„è§å¼¹çª— */}
                    <Modal
                      title="æ·»åŠ ä¿®æ”¹æ„è§"
                      open={revisionModalVisible}
                      onCancel={handleCloseRevisionModal}
                      footer={null}
                      width={600}
                    >
                      <Form form={revisionForm} onFinish={handleAddRevision} layout="vertical">
                        <Form.Item name="version" label="ç‰ˆæœ¬" rules={[{ required: true, message: 'è¯·é€‰æ‹©ç‰ˆæœ¬' }]}>
                          <Select placeholder="è¯·é€‰æ‹©ç‰ˆæœ¬" disabled={!!selectedVersion}>
                            {(orderData.deliveries || []).map(d => (
                              <Option key={d.id} value={d.version}>
                                {d.version} - {d.fileName} 
                                {d.status === 'Approved' && <Tag color="green" style={{ marginLeft: 8 }}>å·²é€šè¿‡</Tag>}
                                {d.status === 'NeedRevision' && <Tag color="orange" style={{ marginLeft: 8 }}>éœ€ä¿®æ”¹</Tag>}
                              </Option>
                            ))}
                          </Select>
                        </Form.Item>
                        <Form.Item name="reason" label="é€€å›åŸå› " rules={[{ required: true, message: 'è¯·é€‰æ‹©é€€å›åŸå› ' }]}>
                          <Select placeholder="è¯·é€‰æ‹©é€€å›åŸå› ">
                            <Option value="ç”»é¢è´¨é‡é—®é¢˜">ç”»é¢è´¨é‡é—®é¢˜</Option>
                            <Option value="éŸ³é¢‘é—®é¢˜">éŸ³é¢‘é—®é¢˜</Option>
                            <Option value="å­—å¹•é—®é¢˜">å­—å¹•é—®é¢˜</Option>
                            <Option value="å†…å®¹ä¸ç¬¦åˆè¦æ±‚">å†…å®¹ä¸ç¬¦åˆè¦æ±‚</Option>
                            <Option value="å…¶ä»–">å…¶ä»–</Option>
                          </Select>
                        </Form.Item>
                        <Form.Item name="content" label="ä¿®æ”¹ç‚¹" rules={[{ required: true, message: 'è¯·è¾“å…¥ä¿®æ”¹ç‚¹' }]}>
                          <TextArea rows={4} placeholder="è¯·è¯¦ç»†è¯´æ˜éœ€è¦ä¿®æ”¹çš„å†…å®¹" />
                        </Form.Item>
                        <Form.Item>
                          <Space style={{ width: '100%', justifyContent: 'flex-end' }}>
                            <Button onClick={handleCloseRevisionModal}>å–æ¶ˆ</Button>
                            <Button type="primary" htmlType="submit">æäº¤ä¿®æ”¹æ„è§</Button>
                          </Space>
                        </Form.Item>
                      </Form>
                    </Modal>
                    
                    <Upload
                      beforeUpload={handleUpload}
                      showUploadList={false}
                    >
                      <Button type="primary" size="large" style={{ marginTop: 16 }}>
                        ğŸ“¤ ä¸Šä¼ æ–°ç‰ˆæœ¬
                      </Button>
                    </Upload>
                  </div>
                </TabPane>

                <TabPane tab="ğŸ’­ æ²Ÿé€š" key="messages">
                  <div style={{ marginTop: 16 }}>
                    <List
                      dataSource={orderData.messages || []}
                      renderItem={(item) => (
                        <List.Item>
                          <List.Item.Meta
                            avatar={<Avatar>{item.sender.charAt(0)}</Avatar>}
                            title={
                              <Space>
                                <span>{item.sender}</span>
                                <span style={{ color: '#8c8c8c', fontSize: 12 }}>
                                  {dayjs(item.time).format('YYYY-MM-DD HH:mm:ss')}
                                </span>
                              </Space>
                            }
                            description={
                              <div>
                                {item.content && (
                                  <div style={{ marginBottom: item.images && item.images.length > 0 ? 8 : 0 }}>
                                    {item.content}
                                  </div>
                                )}
                                {item.images && item.images.length > 0 && (
                                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, marginTop: 8 }}>
                                    {item.images.map((img, index) => (
                                      <div key={index} style={{ position: 'relative' }}>
                                        <img
                                          src={img.url}
                                          alt={img.name}
                                          style={{
                                            maxWidth: '200px',
                                            maxHeight: '200px',
                                            borderRadius: '4px',
                                            cursor: 'pointer',
                                            border: '1px solid #e8e8e8',
                                          }}
                                          onClick={() => {
                                            Modal.info({
                                              title: img.name,
                                              content: (
                                                <img
                                                  src={img.url}
                                                  alt={img.name}
                                                  style={{ width: '100%', maxHeight: '600px', objectFit: 'contain' }}
                                                />
                                              ),
                                              width: 800,
                                            });
                                          }}
                                        />
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            }
                          />
                        </List.Item>
                      )}
                    />
                    <div style={{ marginTop: 16, padding: '16px', background: '#fafafa', borderRadius: '8px' }}>
                      <TextArea
                        rows={4}
                        placeholder="è¾“å…¥æ¶ˆæ¯å†…å®¹"
                        value={messageContent}
                        onChange={(e) => setMessageContent(e.target.value)}
                        style={{ marginBottom: 12 }}
                      />
                      <div style={{ marginBottom: 12 }}>
                        <Upload
                          accept="image/*"
                          beforeUpload={handleImageUpload}
                          onRemove={handleRemoveImage}
                          fileList={messageImages}
                          listType="picture-card"
                          maxCount={9}
                        >
                          {messageImages.length < 9 && (
                            <div>
                              <div style={{ fontSize: 24 }}>+</div>
                              <div style={{ marginTop: 8 }}>ä¸Šä¼ å›¾ç‰‡</div>
                            </div>
                          )}
                        </Upload>
                      </div>
                      <Button type="primary" onClick={handleSendMessage}>å‘é€æ¶ˆæ¯</Button>
                    </div>
                  </div>
                </TabPane>

                <TabPane tab="âœ… å®¡æ ¸ä¸éªŒæ”¶" key="review">
                  <div style={{ marginTop: 16 }}>
                    {orderData.status === 'Approved' ? (
                      <div>
                        <Card>
                          <Alert
                            message="å®¡æ ¸å·²é€šè¿‡"
                            description="è®¢å•å·²é€šè¿‡å®¡æ ¸ï¼Œå¯ä»¥ç”³è¯·éªŒæ”¶"
                            type="success"
                            showIcon
                            style={{ marginBottom: 16 }}
                          />
                          <Button type="primary" size="large" onClick={handleAccept}>
                            ç”³è¯·éªŒæ”¶
                          </Button>
                        </Card>
                      </div>
                    ) : orderData.status === 'Accepted' ? (
                      <Card>
                        <Alert
                          message="å·²éªŒæ”¶"
                          description="è®¢å•å·²å®ŒæˆéªŒæ”¶ï¼Œæ”¶ç›Šå·²å…¥è´¦"
                          type="success"
                          showIcon
                        />
                      </Card>
                    ) : (
                      <div style={{ textAlign: 'center', padding: '40px', color: '#8c8c8c' }}>
                        {orderData.status === 'Submitted' ? 'è®¢å•å·²æäº¤ï¼Œç­‰å¾…å®¡æ ¸' : 'è®¢å•å°šæœªé€šè¿‡å®¡æ ¸'}
                      </div>
                    )}
                  </div>
                </TabPane>
              </Tabs>
            </Card>
            </div>
          </div>

          {/* ä¸Šä¼ æ–‡ä»¶å¯¹è¯æ¡† */}
          <Modal
            title="ä¸Šä¼ äº¤ä»˜æ–‡ä»¶"
            open={uploadModalVisible}
            onOk={handleConfirmUpload}
            onCancel={() => {
              setUploadModalVisible(false);
              setChangeNote('');
            }}
          >
            <div style={{ marginBottom: 16 }}>
              <Upload
                beforeUpload={() => false}
                showUploadList={true}
              >
                <Button>é€‰æ‹©æ–‡ä»¶</Button>
              </Upload>
            </div>
            <div>
              <Text strong>å˜æ›´è¯´æ˜ï¼š</Text>
              <TextArea
                rows={4}
                placeholder="è¯·è¯´æ˜æœ¬æ¬¡æäº¤çš„å˜æ›´å†…å®¹"
                value={changeNote}
                onChange={(e) => setChangeNote(e.target.value)}
                style={{ marginTop: 8 }}
              />
            </div>
          </Modal>
        </div>
      );
    };

    function renderApp() {
      if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
        setTimeout(renderApp, 100);
        return;
      }
      
      try {
        ReactDOM.render(<ProjectSpace />, document.getElementById('root'));
      } catch (error) {
        console.error('æ¸²æŸ“é”™è¯¯:', error);
        document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">é¡µé¢åŠ è½½å¤±è´¥: ' + error.message + '</div>';
      }
    }

    if (document.readyState === 'loading') {
      window.addEventListener('load', renderApp);
    } else {
      renderApp();
    }
  </script>
</body>
</html>
