<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è´¢åŠ¡å¯¹è´¦ - å¤©åˆçŸ­å‰§å‰ªè¾‘æ¥å•å¹³å°</title>
  
  <!-- Ant Design CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.css">
  
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .appLayout {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 200px;
      background: #fff;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.06);
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      overflow-y: auto;
      z-index: 100;
    }

    .sidebarHeader {
      padding: 20px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .logo {
      font-size: 18px;
      font-weight: 600;
      color: #1890ff;
      text-decoration: none;
      display: block;
    }

    .menu {
      padding: 16px 0;
    }

    .menuItem {
      display: block;
      padding: 12px 24px;
      color: #262626;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menuItem:hover {
      background-color: #f0f0f0;
      color: #1890ff;
    }

    .menuItem.active {
      background-color: #e6f7ff;
      color: #1890ff;
      border-left-color: #1890ff;
      font-weight: 500;
    }

    .menuItemIcon {
      margin-right: 8px;
      font-size: 16px;
    }

    .menuGroup {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #f0f0f0;
    }

    .menuGroupTitle {
      padding: 8px 24px;
      font-size: 12px;
      color: #8c8c8c;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .mainContent {
      flex: 1;
      margin-left: 200px;
      min-height: 100vh;
      background: #f5f5f5;
    }

    .financePage {
      padding: 24px;
    }

    .pageHeader {
      background: #fff;
      padding: 16px 24px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .statsCard {
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .statsGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
    }

    .statItem {
      text-align: center;
    }

    .statLabel {
      font-size: 14px;
      color: #8c8c8c;
      margin-bottom: 8px;
    }

    .statValue {
      font-size: 24px;
      font-weight: 600;
      color: #262626;
    }

    .statValue.primary {
      color: #1890ff;
    }

    .statValue.success {
      color: #52c41a;
    }

    .statValue.warning {
      color: #fa8c16;
    }

    .filterCard {
      background: #fff;
      padding: 16px 24px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .tableCard {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      .mainContent {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  
  <!-- Day.js -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  
  <!-- Ant Design JS -->
  <script src="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.js"></script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { Card, Table, Button, Tag, Space, Select, DatePicker, Typography, Statistic, Modal, Form, Input, InputNumber, message, Drawer } = antd;
    const { Title } = Typography;
    const { Option } = Select;
    const { RangePicker } = DatePicker;
    const { TextArea } = Input;

    const FinanceManagement = () => {
      const [ledger, setLedger] = useState([]);
      const [loading, setLoading] = useState(false);
      const [filters, setFilters] = useState({
        settlementStatus: '',
        dateRange: null,
      });
      const [adjustModalVisible, setAdjustModalVisible] = useState(false);
      const [adjustForm] = Form.useForm();
      const [currentRecord, setCurrentRecord] = useState(null);
      const [orderDetailVisible, setOrderDetailVisible] = useState(false);
      const [currentProjectOrders, setCurrentProjectOrders] = useState([]);
      const [currentProjectName, setCurrentProjectName] = useState('');

      useEffect(() => {
        loadLedger();
      }, []);

      const loadLedger = () => {
        setLoading(true);
        
        // ä»è®¢å•æ•°æ®ç”Ÿæˆè´¦æœ¬ï¼ˆæŒ‰è®¢å•ï¼‰
        const orders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
        const acceptedOrders = orders.filter(o => o.status === 'Accepted');
        
        let orderLedgerData = acceptedOrders.map(order => {
          const acceptTime = order.acceptTime || dayjs().subtract(Math.floor(Math.random() * 30), 'day').format('YYYY-MM-DD HH:mm:ss');
          const takeTime = order.takeTime || acceptTime;
          const dueTime = order.dueTime || dayjs(takeTime).add(7, 'day').format('YYYY-MM-DD HH:mm:ss');
          
          return {
            id: `ledger_${order.id}`,
            orderId: order.orderId || order.id,
            projectId: order.projectId,
            projectName: order.projectName || 'æµ‹è¯•é¡¹ç›®',
            taker: order.taker || 'å­¦å‘˜A',
            amount: order.amount || Math.floor(Math.random() * 1000) + 500,
            acceptTime: acceptTime,
            takeTime: takeTime,
            dueTime: dueTime,
            status: order.status || 'Accepted',
            deduction: 0,
            settlementStatus: ['æœªç»“ç®—', 'å·²ç»“ç®—'][Math.floor(Math.random() * 2)],
            settlementMonth: null,
          };
        });

        // ä»localStorageè¯»å–å·²æœ‰è´¦æœ¬æ•°æ®
        const savedLedger = JSON.parse(localStorage.getItem('financeLedger') || '[]');
        if (savedLedger.length > 0) {
          // è¡¥å……ç¼ºå¤±çš„å­—æ®µ
          orderLedgerData = savedLedger.map(order => {
            if (!order.takeTime) {
              order.takeTime = order.acceptTime || dayjs().subtract(Math.floor(Math.random() * 30), 'day').format('YYYY-MM-DD HH:mm:ss');
            }
            if (!order.dueTime) {
              order.dueTime = dayjs(order.takeTime).add(7, 'day').format('YYYY-MM-DD HH:mm:ss');
            }
            if (!order.status) {
              order.status = 'Accepted';
            }
            return order;
          });
        } else {
          localStorage.setItem('financeLedger', JSON.stringify(orderLedgerData));
        }

        // æŒ‰é¡¹ç›®åç§°åˆ†ç»„ç»Ÿè®¡
        const projectMap = {};
        orderLedgerData.forEach(order => {
          const projectName = order.projectName;
          if (!projectMap[projectName]) {
            projectMap[projectName] = {
              projectName: projectName,
              projectId: order.projectId,
              orders: [],
              totalAmount: 0,
              totalDeduction: 0,
              acceptTimes: [],
              settlementStatus: order.settlementStatus,
              settlementMonth: order.settlementMonth,
            };
          }
          projectMap[projectName].orders.push(order);
          projectMap[projectName].totalAmount += order.amount || 0;
          projectMap[projectName].totalDeduction += order.deduction || 0;
          if (order.acceptTime) {
            projectMap[projectName].acceptTimes.push(order.acceptTime);
          }
          // å¦‚æœè®¢å•ä¸­æœ‰å·²ç»“ç®—çš„ï¼Œé¡¹ç›®çŠ¶æ€ä¸ºå·²ç»“ç®—ï¼›å¦åˆ™ä¸ºæœªç»“ç®—
          if (order.settlementStatus === 'å·²ç»“ç®—') {
            projectMap[projectName].settlementStatus = 'å·²ç»“ç®—';
            if (!projectMap[projectName].settlementMonth && order.settlementMonth) {
              projectMap[projectName].settlementMonth = order.settlementMonth;
            }
          }
        });

        // è½¬æ¢ä¸ºæ•°ç»„ï¼Œè®¡ç®—æœ€æ—©éªŒæ”¶æ—¶é—´
        const projectLedgerData = Object.values(projectMap).map(project => {
          const earliestAcceptTime = project.acceptTimes.length > 0 
            ? project.acceptTimes.sort()[0] 
            : null;
          return {
            id: `project_${project.projectId || project.projectName}`,
            projectName: project.projectName,
            projectId: project.projectId,
            totalAmount: project.totalAmount,
            orderCount: project.orders.length,
            earliestAcceptTime: earliestAcceptTime,
            totalDeduction: project.totalDeduction,
            settlementStatus: project.settlementStatus,
            settlementMonth: project.settlementMonth,
            orders: project.orders, // ä¿å­˜è®¢å•åˆ—è¡¨ç”¨äºåç»­æ“ä½œ
          };
        });

        setLedger(projectLedgerData);
        setLoading(false);
      };

      const filteredLedger = useMemo(() => {
        return ledger.filter(item => {
          if (filters.settlementStatus && item.settlementStatus !== filters.settlementStatus) return false;
          if (filters.dateRange && filters.dateRange[0] && filters.dateRange[1] && item.earliestAcceptTime) {
            const acceptTime = dayjs(item.earliestAcceptTime);
            if (acceptTime.isBefore(filters.dateRange[0]) || acceptTime.isAfter(filters.dateRange[1])) {
              return false;
            }
          }
          return true;
        });
      }, [ledger, filters]);

      const stats = useMemo(() => {
        const totalAmount = filteredLedger.reduce((sum, item) => sum + (item.totalAmount || 0), 0);
        const totalDeduction = filteredLedger.reduce((sum, item) => sum + (item.totalDeduction || 0), 0);
        const settledAmount = filteredLedger
          .filter(item => item.settlementStatus === 'å·²ç»“ç®—')
          .reduce((sum, item) => sum + (item.totalAmount || 0) - (item.totalDeduction || 0), 0);
        const unsettledAmount = filteredLedger
          .filter(item => item.settlementStatus === 'æœªç»“ç®—')
          .reduce((sum, item) => sum + (item.totalAmount || 0) - (item.totalDeduction || 0), 0);
        const totalOrderCount = filteredLedger.reduce((sum, item) => sum + (item.orderCount || 0), 0);

        return {
          totalAmount,
          totalDeduction,
          settledAmount,
          unsettledAmount,
          totalCount: filteredLedger.length,
          totalOrderCount,
          settledCount: filteredLedger.filter(item => item.settlementStatus === 'å·²ç»“ç®—').length,
        };
      }, [filteredLedger]);

      const handleAdjust = (record) => {
        setCurrentRecord(record);
        adjustForm.setFieldsValue({ deduction: record.totalDeduction || 0, reason: '' });
        setAdjustModalVisible(true);
      };

      const handleAdjustSubmit = () => {
        adjustForm.validateFields().then(values => {
          // æ›´æ–°é¡¹ç›®çº§åˆ«çš„æ‰£æ¬¾
          const updatedLedger = ledger.map(item => {
            if (item.id === currentRecord.id) {
              const newTotalDeduction = values.deduction;
              // æ›´æ–°é¡¹ç›®ä¸‹æ‰€æœ‰è®¢å•çš„æ‰£æ¬¾ï¼ˆå¹³å‡åˆ†é…æˆ–æŒ‰æ¯”ä¾‹ï¼‰
              const updatedOrders = item.orders.map(order => ({
                ...order,
                deduction: Math.round((newTotalDeduction / item.totalAmount) * order.amount),
              }));
              
              return {
                ...item,
                totalDeduction: newTotalDeduction,
                orders: updatedOrders,
                adjustReason: values.reason,
                adjustTime: dayjs().format('YYYY-MM-DD HH:mm:ss'),
              };
            }
            return item;
          });
          
          // åŒæ­¥æ›´æ–°è®¢å•çº§åˆ«çš„è´¦æœ¬æ•°æ®
          const allOrders = [];
          updatedLedger.forEach(project => {
            allOrders.push(...project.orders);
          });
          localStorage.setItem('financeLedger', JSON.stringify(allOrders));
          
          setLedger(updatedLedger);
          setAdjustModalVisible(false);
          adjustForm.resetFields();
          message.success('æ‰£æ¬¾è°ƒæ•´å·²ä¿å­˜');
        });
      };

      const handleSettleStatusChange = (record, newStatus) => {
        const updatedLedger = ledger.map(item => {
          if (item.id === record.id) {
            const settlementMonth = newStatus === 'å·²ç»“ç®—' ? dayjs().format('YYYY-MM') : null;
            // æ›´æ–°é¡¹ç›®ä¸‹æ‰€æœ‰è®¢å•çš„ç»“ç®—çŠ¶æ€
            const updatedOrders = item.orders.map(order => ({
              ...order,
              settlementStatus: newStatus,
              settlementMonth: settlementMonth,
            }));
            
            return {
              ...item,
              settlementStatus: newStatus,
              settlementMonth: settlementMonth,
              orders: updatedOrders,
            };
          }
          return item;
        });
        
        // åŒæ­¥æ›´æ–°è®¢å•çº§åˆ«çš„è´¦æœ¬æ•°æ®
        const allOrders = [];
        updatedLedger.forEach(project => {
          allOrders.push(...project.orders);
        });
        localStorage.setItem('financeLedger', JSON.stringify(allOrders));
        
        setLedger(updatedLedger);
        message.success(`ç»“ç®—çŠ¶æ€å·²æ›´æ–°ä¸º${newStatus}`);
      };

      const handleExport = () => {
        message.success('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­');
      };

      const handleViewOrders = (record) => {
        setCurrentProjectOrders(record.orders || []);
        setCurrentProjectName(record.projectName);
        setOrderDetailVisible(true);
      };

      const statusMap = {
        'InProgress': { color: 'blue', text: 'è¿›è¡Œä¸­' },
        'Submitted': { color: 'green', text: 'å·²æäº¤' },
        'NeedRevision': { color: 'orange', text: 'é€€å›ä¿®æ”¹' },
        'Approved': { color: 'green', text: 'å®¡æ ¸é€šè¿‡' },
        'Accepted': { color: 'success', text: 'å·²éªŒæ”¶' },
        'Closed': { color: 'default', text: 'å·²å…³é—­' },
      };

      const orderDetailColumns = [
        {
          title: 'è®¢å•å·',
          dataIndex: 'orderId',
          key: 'orderId',
          width: 150,
        },
        {
          title: 'æ¥å•äºº',
          dataIndex: 'taker',
          key: 'taker',
          width: 120,
        },
        {
          title: 'æ¥å•æ—¶é—´',
          dataIndex: 'takeTime',
          key: 'takeTime',
          width: 180,
          render: (time) => time ? dayjs(time).format('YYYY-MM-DD HH:mm:ss') : '-',
        },
        {
          title: 'æˆªæ­¢æ—¶é—´',
          dataIndex: 'dueTime',
          key: 'dueTime',
          width: 180,
          render: (time) => time ? dayjs(time).format('YYYY-MM-DD HH:mm:ss') : '-',
        },
        {
          title: 'è®¢å•çŠ¶æ€',
          dataIndex: 'status',
          key: 'status',
          width: 120,
          render: (status) => {
            const statusInfo = statusMap[status] || { color: 'default', text: status };
            return <Tag color={statusInfo.color}>{statusInfo.text}</Tag>;
          },
        },
        {
          title: 'è®¢å•é‡‘é¢',
          dataIndex: 'amount',
          key: 'amount',
          width: 120,
          align: 'right',
          render: (amount) => <span style={{ fontWeight: 500, color: '#52c41a' }}>Â¥{amount ? amount.toLocaleString() : 0}</span>,
        },
      ];

      const columns = [
        { 
          title: 'é¡¹ç›®åç§°', 
          dataIndex: 'projectName', 
          key: 'projectName', 
          width: 200, 
          ellipsis: true,
          fixed: 'left',
        },
        { 
          title: 'é¡¹ç›®ID', 
          dataIndex: 'projectId', 
          key: 'projectId', 
          width: 150,
          render: (id) => id || '-'
        },
        { 
          title: 'é‡‘é¢ç»Ÿè®¡', 
          dataIndex: 'totalAmount', 
          key: 'totalAmount', 
          width: 150, 
          align: 'right',
          render: (amount) => <span style={{ fontWeight: 500, color: '#52c41a' }}>Â¥{amount.toLocaleString()}</span>
        },
        { 
          title: 'è®¢å•æ€»æ•°', 
          dataIndex: 'orderCount', 
          key: 'orderCount', 
          width: 120,
          align: 'center',
          render: (count, record) => (
            <Button 
              type="link" 
              style={{ padding: 0, height: 'auto', fontWeight: 500 }}
              onClick={() => handleViewOrders(record)}
            >
              {count} å•
            </Button>
          )
        },
        { 
          title: 'éªŒæ”¶æ—¶é—´ï¼ˆå…¥è´¦ï¼‰', 
          dataIndex: 'earliestAcceptTime', 
          key: 'earliestAcceptTime', 
          width: 180,
          render: (time) => time ? dayjs(time).format('YYYY-MM-DD HH:mm:ss') : '-'
        },
        { 
          title: 'æ‰£æ¬¾è°ƒæ•´', 
          dataIndex: 'totalDeduction', 
          key: 'totalDeduction', 
          width: 150,
          align: 'right',
          render: (deduction) => 
            deduction > 0 ? <span style={{ color: '#ff4d4f', fontWeight: 500 }}>-Â¥{deduction.toLocaleString()}</span> : '-'
        },
        { 
          title: 'ç»“ç®—çŠ¶æ€', 
          dataIndex: 'settlementStatus', 
          key: 'settlementStatus', 
          width: 150,
          render: (status, record) => (
            <Select
              value={status}
              onChange={(value) => handleSettleStatusChange(record, value)}
              style={{ width: 120 }}
            >
              <Option value="æœªç»“ç®—">æœªç»“ç®—</Option>
              <Option value="å·²ç»“ç®—">å·²ç»“ç®—</Option>
            </Select>
          )
        },
        { 
          title: 'ç»“ç®—æœˆä»½', 
          dataIndex: 'settlementMonth', 
          key: 'settlementMonth', 
          width: 120,
          render: (month) => month || '-'
        },
        { 
          title: 'æ“ä½œ', 
          key: 'action', 
          width: 150,
          fixed: 'right',
          render: (_, record) => (
            <Button size="small" onClick={() => handleAdjust(record)}>æ‰£æ¬¾è°ƒæ•´</Button>
          )
        },
      ];

      return (
        <div className="appLayout">
          {/* å·¦ä¾§å¯¼èˆªæ  */}
          <div className="sidebar">
            <div className="sidebarHeader">
              <a href="Home.html" className="logo">ğŸ¬ å¤©åˆçŸ­å‰§å¹³å°</a>
            </div>
            <nav className="menu">
              <a href="Home.html" className="menuItem">
                <span className="menuItemIcon">ğŸ </span>
                é¦–é¡µ
              </a>
              <a href="ProjectHall.html" className="menuItem">
                <span className="menuItemIcon">ğŸ“‹</span>
                æ¥å•å¤§å…
              </a>
              <a href="Leaderboard.html" className="menuItem">
                <span className="menuItemIcon">ğŸ†</span>
                å¤©æ¢¯æ¦œå•
              </a>
              <a href="Account.html" className="menuItem">
                <span className="menuItemIcon">ğŸ’°</span>
                è´¦æˆ·ä¸æ”¶ç›Š
              </a>
              <a href="MyProjects.html" className="menuItem">
                <span className="menuItemIcon">ğŸš€</span>
                æˆ‘çš„é¡¹ç›®
              </a>
              
              <div className="menuGroup">
                <div className="menuGroupTitle">åå°ç®¡ç†</div>
                <a href="ReviewQueue.html" className="menuItem">
                  <span className="menuItemIcon">âœ…</span>
                  ä»»åŠ¡å®¡æ ¸
                </a>
                <a href="ProjectManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ“‹</span>
                  é¡¹ç›®ç®¡ç†
                </a>
                <a href="StudentManagement.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ‘¥</span>
                  å­¦å‘˜ç®¡ç†
                </a>
                <a href="FinanceManagement.html" className="menuItem active">
                  <span className="menuItemIcon">ğŸ’°</span>
                  è´¢åŠ¡å¯¹è´¦
                </a>
                <a href="DashboardManagement.html" className="menuItem" style={{ display: 'none' }}>
                  <span className="menuItemIcon">ğŸ“Š</span>
                  æ¦œå•ä¸æ•°æ®
                </a>
                <a href="DataBoard.html" className="menuItem">
                  <span className="menuItemIcon">ğŸ“ˆ</span>
                  æ•°æ®çœ‹æ¿
                </a>
              </div>
            </nav>
          </div>

          {/* ä¸»å†…å®¹åŒº */}
          <div className="mainContent">
            <div className="financePage">
              <div className="pageHeader">
                <Title level={2} style={{ margin: 0 }}>è´¢åŠ¡å¯¹è´¦</Title>
                <Button onClick={handleExport}>å¯¼å‡ºå¯¹è´¦æŠ¥è¡¨</Button>
              </div>

              {/* ç»Ÿè®¡å¡ç‰‡ */}
              <div className="statsCard">
                <div className="statsGrid">
                  <div className="statItem">
                    <div className="statLabel">é¡¹ç›®æ•°</div>
                    <div className="statValue primary">{stats.totalCount}</div>
                  </div>
                  <div className="statItem">
                    <div className="statLabel">éªŒæ”¶è®¢å•æ•°</div>
                    <div className="statValue primary">{stats.totalOrderCount}</div>
                  </div>
                  <div className="statItem">
                    <div className="statLabel">åº”ä»˜é‡‘é¢</div>
                    <div className="statValue success">Â¥{stats.totalAmount.toLocaleString()}</div>
                  </div>
                  <div className="statItem">
                    <div className="statLabel">æ‰£æ¬¾è°ƒæ•´</div>
                    <div className="statValue warning">Â¥{stats.totalDeduction.toLocaleString()}</div>
                  </div>
                  <div className="statItem">
                    <div className="statLabel">å·²ç»“ç®—é‡‘é¢</div>
                    <div className="statValue success">Â¥{stats.settledAmount.toLocaleString()}</div>
                  </div>
                  <div className="statItem">
                    <div className="statLabel">æœªç»“ç®—é‡‘é¢</div>
                    <div className="statValue warning">Â¥{stats.unsettledAmount.toLocaleString()}</div>
                  </div>
                  <div className="statItem">
                    <div className="statLabel">å·²ç»“ç®—è®¢å•æ•°</div>
                    <div className="statValue primary">{stats.settledCount}</div>
                  </div>
                </div>
              </div>

              {/* ç­›é€‰åŒº */}
              <div className="filterCard">
                <Space size="middle" wrap>
                  <span>ç»“ç®—çŠ¶æ€ï¼š</span>
                  <Select
                    style={{ width: 150 }}
                    placeholder="å…¨éƒ¨"
                    allowClear
                    value={filters.settlementStatus}
                    onChange={(value) => setFilters({ ...filters, settlementStatus: value || '' })}
                  >
                    <Option value="æœªç»“ç®—">æœªç»“ç®—</Option>
                    <Option value="å·²ç»“ç®—">å·²ç»“ç®—</Option>
                  </Select>

                  <span>éªŒæ”¶æ—¶é—´ï¼ˆå…¥è´¦ï¼‰ï¼š</span>
                  <RangePicker
                    value={filters.dateRange}
                    onChange={(dates) => setFilters({ ...filters, dateRange: dates })}
                  />
                </Space>
              </div>

              {/* è¡¨æ ¼ */}
              <div className="tableCard">
                <Table
                  columns={columns}
                  dataSource={filteredLedger}
                  loading={loading}
                  rowKey="id"
                  scroll={{ x: 1200 }}
                  pagination={{ pageSize: 20, showTotal: (total) => `å…± ${total} ä¸ªé¡¹ç›®` }}
                />
              </div>
            </div>
          </div>

          {/* æ‰£æ¬¾è°ƒæ•´å¼¹çª— */}
          <Modal
            title="æ‰£æ¬¾è°ƒæ•´"
            open={adjustModalVisible}
            onOk={handleAdjustSubmit}
            onCancel={() => { setAdjustModalVisible(false); adjustForm.resetFields(); }}
            okText="ç¡®è®¤"
            cancelText="å–æ¶ˆ"
            width={600}
          >
            <Form form={adjustForm} layout="vertical">
              <Form.Item
                name="deduction"
                label="æ‰£æ¬¾é‡‘é¢"
                rules={[{ required: true, message: 'è¯·è¾“å…¥æ‰£æ¬¾é‡‘é¢' }]}
              >
                <InputNumber min={0} style={{ width: '100%' }} placeholder="è¯·è¾“å…¥æ‰£æ¬¾é‡‘é¢" />
              </Form.Item>
              <Form.Item
                name="reason"
                label="æ‰£æ¬¾åŸå› "
                rules={[{ required: true, message: 'è¯·å¡«å†™æ‰£æ¬¾åŸå› ' }]}
              >
                <TextArea rows={4} placeholder="è¯·å¡«å†™æ‰£æ¬¾åŸå› " />
              </Form.Item>
            </Form>
          </Modal>

          {/* è®¢å•è¯¦æƒ…æŠ½å±‰ */}
          <Drawer
            title={`${currentProjectName} - è®¢å•åˆ—è¡¨`}
            placement="right"
            width={900}
            onClose={() => setOrderDetailVisible(false)}
            open={orderDetailVisible}
          >
            <Table
              columns={orderDetailColumns}
              dataSource={currentProjectOrders}
              rowKey="id"
              pagination={{
                pageSize: 10,
                showTotal: (total) => `å…± ${total} æ¡è®¢å•`,
              }}
              scroll={{ x: 800 }}
            />
          </Drawer>
        </div>
      );
    };

    window.addEventListener('load', function() {
      try {
        ReactDOM.render(<FinanceManagement />, document.getElementById('root'));
      } catch (error) {
        console.error('æ¸²æŸ“é”™è¯¯:', error);
        document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">é¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ã€‚</div>';
      }
    });
  </script>
</body>
</html>
